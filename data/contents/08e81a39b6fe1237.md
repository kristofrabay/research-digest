# Welcome EmbeddingGemma, Google's new efficient embedding model

**URL:** https://huggingface.co/blog/embeddinggemma
**Published:** 2025-07-01T00:00:00.000Z

---

## Summary

The webpage introduces **EmbeddingGemma**, Google's new efficient, state-of-the-art multilingual embedding model, perfect for on-device use cases.

Here is a summary of how it relates to your query topics:

*   **Embeddings (new efficient models):** EmbeddingGemma is a new, efficient model with only **308M parameters** and a **2K context window**. It ranks as the highest text-only multilingual embedding model under 500M on the MTEB benchmark.
*   **Vector Databases / Retrieval:** The model is designed for retrieval tasks, using a Gemma3 transformer backbone modified with bi-directional attention (making it an encoder). It supports **Matryoshka Representation Learning (MRL)**, allowing the 768-dimensional output vector to be truncated to 512, 256, or 128 dimensions for faster and cheaper downstream processing like similarity search in vector databases.
*   **RAG Architectures / RAG Alternatives:** The model is explicitly mentioned as unlocking new possibilities for **mobile RAG pipelines** and agents.
*   **Rerankers:** The model supports a specific prompt for **Reranking** tasks (`"Reranking": "task: search result | query: "`).
*   **Hybrid Search:** Not explicitly mentioned, but the model's strong retrieval capabilities support the embedding component of hybrid search.
*   **Chunking Strategies:** Not explicitly mentioned, though the model has a 2048-token context window, which is relevant to chunking decisions in RAG.

The page also details extensive **Usage** instructions across various frameworks relevant to RAG pipelines, including **LangChain**, **LlamaIndex**, **Haystack**, and **txtai**, and provides deployment options via **Text Embeddings Inference (TEI)**. Furthermore, it covers **Finetuning** the model for domain-specific tasks.

---

## Full Content

Welcome EmbeddingGemma, Google&#39;s new efficient embedding model
[![Hugging Face's logo](https://huggingface.co/front/assets/huggingface_logo-noborder.svg)Hugging Face](https://huggingface.co/)
[Back to Articles](https://huggingface.co/blog)
# [](#welcome-embeddinggemma-googles-new-efficient-embedding-model)Welcome EmbeddingGemma, Google's new efficient embedding model
Published
September 4, 2025
[Update on GitHub](https://github.com/huggingface/blog/blob/main/embeddinggemma.md)
[
Upvote
266
](https://huggingface.co/login?next=/blog/embeddinggemma)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1642412329881-5e6b7a61d4cd9779932a7601.png)](https://huggingface.co/loretoparisi)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1594214747713-5e9ecfc04957053f60648a3e.png)](https://huggingface.co/lhoestq)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1590676895158-noauth.jpeg)](https://huggingface.co/rahulbana)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1591114977477-noauth.png)](https://huggingface.co/davidmezzetti)
* [![](https://huggingface.co/avatars/5aec4a666b524d0ca052fb82c45a0d25.svg)](https://huggingface.co/kalyan-ks)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/5f106ce5348d4c7346cd19ab/Uu08yZZlFuj3dtG4wld3n.jpeg)](https://huggingface.co/abdullah)
* +260
[![Tom Aarsen's avatar](https://cdn-avatars.huggingface.co/v1/production/uploads/6317233cc92fd6fee317e030/cJHSvvimr1kqgQfHOjO5n.png)](https://huggingface.co/tomaarsen)
[Tom Aarsen
tomaarsen
Follow
](https://huggingface.co/tomaarsen)
[![Joshua's avatar](https://cdn-avatars.huggingface.co/v1/production/uploads/61b253b7ac5ecaae3d1efe0c/hwiQ0uvz3t-L5a-NtBIO6.png)](https://huggingface.co/Xenova)
[Joshua
Xenova
Follow
](https://huggingface.co/Xenova)
[![Alvaro Bartolome's avatar](https://cdn-avatars.huggingface.co/v1/production/uploads/60f0608166e5701b80ed3f02/BHso-wSWpR9b8b8CKvodC.jpeg)](https://huggingface.co/alvarobartt)
[Alvaro Bartolome
alvarobartt
Follow
](https://huggingface.co/alvarobartt)
[![Aritra Roy Gosthipaty's avatar](https://cdn-avatars.huggingface.co/v1/production/uploads/608aabf24955d2bfc3cd99c6/-YxmtpzEmf3NKOTktODRP.jpeg)](https://huggingface.co/ariG23498)
[Aritra Roy Gosthipaty
ariG23498
Follow
](https://huggingface.co/ariG23498)
[![Pedro Cuenca's avatar](https://cdn-avatars.huggingface.co/v1/production/uploads/1617264212503-603d25b75f9d390ab190b777.jpeg)](https://huggingface.co/pcuenq)
[Pedro Cuenca
pcuenq
Follow
](https://huggingface.co/pcuenq)
[![Sergio Paniego's avatar](https://cdn-avatars.huggingface.co/v1/production/uploads/61929226ded356549e20c5da/ONUjP2S5fUWd07BiFXm0i.jpeg)](https://huggingface.co/sergiopaniego)
[Sergio Paniego
sergiopaniego
Follow
](https://huggingface.co/sergiopaniego)
## [](#tldr)TL;DR
Today, Google releases[EmbeddingGemma](https://huggingface.co/collections/google/embeddinggemma-68b9ae3a72a82f0562a80dc4), a state-of-the-art multilingual embedding model perfect for on-device use cases. Designed for speed and efficiency, the model features a compact size of**308M parameters**and a**2K context window**, unlocking new possibilities for mobile RAG pipelines, agents, and more. EmbeddingGemma is trained to support over**100 languages**and is the highest-ranking text-only multilingual embedding model under 500M on the Massive Text Embedding Benchmark (MTEB) at the time of writing.
## [](#table-of-contents)Table of Contents
* [Introduction](#introduction)
* [Evaluation](#evaluation)
* [Demo](#demo)
* [Usage](#usage)
* [Sentence Transformers](#sentence-transformers)
* [Retrieval](#retrieval)
* [LangChain](#langchain)
* [LlamaIndex](#llamaindex)
* [Haystack](#haystack)
* [txtai](#txtai)
* [Transformers.js](#transformersjs)
* [Text Embeddings Inference](#text-embeddings-inference)
* [ONNX Runtime](#onnx-runtime)
* [Finetuning](#finetuning)
* [Full Finetuning Script](#full-finetuning-script)
* [Training](#training)
* [Finetuned Evaluation](#finetuned-evaluation)
* [Further Reading](#further-reading)## [](#introduction)Introduction
[Text embeddings](https://sbert.net/)have become the backbone of modern naturalâ€‘language applications, turning words, sentences, and documents into dense vectors that capture meaning, sentiment, and intent. These vectors enable fast similarity search, clustering, classification, and retrieval across massive corpora, powering everything from recommendation engines and semantic search to retrieval-augmented generation and codeâ€‘search tools. Embedding models that calculate these embeddings are widely used, with well[over 200 million monthly downloads on Hugging Face](https://huggingface.co/models?library=sentence-transformers&amp;sort=downloads).
Building on this foundation, Google DeepMindâ€™s**EmbeddingGemma**arrives as the newest, most capable small multilingual embedding model yet. With just 308M parameters, a 2kâ€‘token context window, and support for over 100 languages, EmbeddingGemma delivers stateâ€‘ofâ€‘theâ€‘art performance on the Massive Multilingual Text Embedding Benchmark (MMTEB) while staying under 200â€¯MB of RAM when quantized.
The various design choices result in a very practical, open-source tool for computing high-quality multilingual embeddings on everyday devices.
In this blogpost, we describe the EmbeddingGemma architecture and training, and show you how to use the model with various frameworks like Sentence Transformers, LangChain, LlamaIndex, Haystack, txtai, Transformers.js, Text Embedding Inference, and ONNX.
Afterwards, we demonstrate how to finetune EmbeddingGemma on your domain for even stronger performance. In our example, we finetune EmbeddingGemma on the Medical Instruction and Retrieval Dataset (MIRIAD). The resulting model,[sentence-transformers/embeddinggemma-300m-medical](https://huggingface.co/sentence-transformers/embeddinggemma-300m-medical), achieves state-of-the-art performance on our task: retrieving passages of scientific medical papers in response to detailed medical questions. It even[outperforms models twice as big](#finetuned-evaluation)on this task.
## [](#architecture)Architecture
EmbeddingGemma builds on the[Gemma3](https://huggingface.co/blog/gemma3)transformers backbone, but modified to use bi-directional attention instead of causal (one-way) attention. This means that earlier tokens in the sequence can attend to later tokens, effectively turning the architecture from a decoder into an encoder. Encoder models can outperform LLMs, which are decoders, on embedding tasks like retrieval ([Weller et al., 2025](https://arxiv.org/abs/2507.11412)). With this backbone, the model can process a sizable 2048 tokens at once, sufficient for typical retrieval inputs, especially given that larger inputs often result in information loss in the text embeddings.
Beyond the new Gemma3-based encoder backbone, which produces token embeddings, a mean pooling layer converts these token embeddings into text embeddings. Lastly, two dense layers transform the text embeddings into their final form, a 768-dimensional vector.
The EmbeddingGemma model has been trained with[Matryoshka Representation Learning (MRL)](https://huggingface.co/blog/matryoshka), allowing you to truncate the 768â€‘dimensional output to 512, 256, or 128 dimensions on demand. This results in faster downstream processing and lower memory and disk space utilization. See the[Sentence Transformers usage](#sentence-transformers)for a snippet showing how to perform this truncation.
The model has been trained using a carefully curated, multilingual corpus totalling approximately 320 billion tokens. The proprietary dataset is a blend of publicly available web text, code and technical documentation, and synthetic taskâ€‘specific examples. It has been filtered to avoid Child Sexual Abuse Material (CSAM), sensitive data, and low-quality or unsafe content.
## [](#evaluation)Evaluation
EmbeddingGemma was benchmarked on the MMTEB (Multilingual,â€¯v2) and MTEB (English,â€¯v2) suites, which span a wide range of tasks, domains, and languages. Despite its modest 308Mâ€‘parameter size, the model consistently beats comparable baselines while keeping a very small memory footprint.
|MTEB (Multilingual, v2) Performance|MTEB (English, v2) Performance|
![](https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/blog/embeddinggemma/embeddinggemma-300m-mteb-multilingual.png)|![](https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/blog/embeddinggemma/embeddinggemma-300m-mteb-eng.png)|
The results will be listed on the official[MTEB Leaderboard](https://huggingface.co/spaces/mteb/leaderboard). We exclude any model that has been trained on more than 20% of the MTEB data, to mitigate potential overâ€‘fitting.
## [](#demo)Demo
*The[demo](https://huggingface.co/spaces/webml-community/semantic-galaxy)can
also be experienced in full screen.*
Your browser does not support the video tag.
*Experience the[demo](https://huggingface.co/spaces/webml-community/semantic-galaxy)yourself on a Desktop device.*
## [](#usage)Usage
EmbeddingGemma is integrated with many popular tools, making it easy to incorporate into your existing workflows and applications. The model has been integrated in Sentence Transformers, and thus also in projects that use Sentence Transformers behind the scenes, such as LangChain, LlamaIndex, Haystack, and txtai. See the examples below to get started with your preferred framework.
For production deployments, you can use[Text Embeddings Inference](https://huggingface.co/docs/text-embeddings-inference/en/index)(TEI) to serve the model efficiently on various hardware configurations, and you can use[Transformers.js](https://huggingface.co/docs/transformers.js/index)for use in web applications.
Regardless of your framework choice, you should be mindful of the**prompts**. For embedding models, prompts are prepended to the input text to allow the model to distinguish between different tasks. EmbeddingGemma was trained with these prompt names and prompts, so they should also be included when using the model:
* `query`:`"task: search result | query: "`,
* `document`:`"title: none | text: "`,
* `BitextMining`:`"task: search result | query: "`,
* `Clustering`:`"task: clustering | query: "`,
* `Classification`:`"task: classification | query: "`,
* `InstructionRetrieval`:`"task: code retrieval | query: "`,
* `MultilabelClassification`:`"task: classification | query: "`,
* `PairClassification`:`"task: sentence similarity | query: "`,
* `Reranking`:`"task: search result | query: "`,
* `Retrieval-query`:`"task: search result | query: "`,
* `Retrieval-document`:`"title: none | text: "`,
* `STS`:`"task: sentence similarity | query: "`,
* `Summarization`:`"task: summarization | query: "`
In Sentence Transformers, the`query`and`document`prompts are used automatically when calling`model.encode\_query`and`model.encode\_document`, but for other frameworks you might have to: $
1. specify prompt names (e.g. "Reranking"),
2. specify prompt strings (e.g. "task: search result | query: "), or
3. manually prepend the prompts to your input text.
The following example scripts will demonstrate this with various frameworks.
### [](#sentence-transformers)Sentence Transformers
You will need to install the following packages:
```
`pip install git+https://github.com/huggingface/transformers@v4.56.0-Embedding-Gemma-preview
pip install sentence-transformers&gt;=5.0.0`
```
#### [](#retrieval)Retrieval
Inference using Sentence Transformers is rather simple, see this example for semantic search:
```
`fromsentence\_transformersimportSentenceTransformer# Download from the ðŸ¤—Hubmodel = SentenceTransformer("google/embeddinggemma-300m")# Run inference with queries and documentsquery ="Which planet is known as the Red Planet?"documents = ["Venus is often called Earth's twin because of its similar size and proximity.","Mars, known for its reddish appearance, is often referred to as the Red Planet.","Jupiter, the largest planet in our solar system, has a prominent red spot.","Saturn, famous for its rings, is sometimes mistaken for the Red Planet."]
query\_embeddings = model.encode\_query(query)
document\_embeddings = model.encode\_document(documents)print(query\_embeddings.shape, document\_embeddings.shape)# (768,) (4, 768)# Compute similarities to determine a rankingsimilarities = model.similarity(query\_embeddings, document\_embeddings)print(similarities)# tensor([[0.3011, 0.6359, 0.4930, 0.4889]])# Convert similarities to a rankingranking = similarities.argsort(descending=True)[0]print(ranking)# tensor([1, 2, 3, 0])`
```
* [Sentence Transformers`encode\_query`method documentation](https://sbert.net/docs/package_reference/sentence_transformer/SentenceTransformer.html#sentence_transformers.SentenceTransformer.encode_query)
* [Sentence Transformers`encode\_document`method documentation](https://sbert.net/docs/package_reference/sentence_transformer/SentenceTransformer.html#sentence_transformers.SentenceTransformer.encode_document)
* [Sentence Transformers`similarity`method documentation](https://sbert.net/docs/package_reference/sentence_transformer/SentenceTransformer.html#sentence_transformers.SentenceTransformer.similarity)Click to see non-retrieval code
If youâ€™re not looking to use this model for Information Retrieval, then youâ€™re likely best off using the most general`encode`method together with the model prompt that best describes your downstream task out of these options:
* `BitextMining`: Find translated sentence pairs in two languages.
* `Clustering`: Find similar texts to group them together.
* `Classification`: Assign predefined labels to texts.
* `InstructionRetrieval`: Retrieve relevant code snippets based on natural language instructions.
* `MultilabelClassification`: Assign multiple labels to texts.
* `PairClassification`: Assign predefined labels to texts.
* `Reranking`: Reorder search results based on relevance.
* `Retrieval-query`: Retrieve documents based on a query.
* `Retrieval-document`: Retrieve documents based on their content.
* `STS`: Compute semantic textual similarity between texts.
* `Summarization`: Generate concise summaries of texts.
```
`fromsentence\_transformersimportSentenceTransformer# Download from the ðŸ¤—Hubmodel = SentenceTransformer("google/embeddinggemma-300m")# Let's inspect the configured promptsprint(model.prompts)# {# "query": "task: search result | query: ",# "document": "title: none | text: ",# "BitextMining": "task: search result | query: ",# "Clustering": "task: clustering | query: ",# "Classification": "task: classification | query: ",# "InstructionRetrieval": "task: code retrieval | query: ",# "MultilabelClassification": "task: classification | query: ",# "PairClassification": "task: sentence similarity | query: ",# "Reranking": "task: search result | query: ",# "Retrieval-query": "task: search result | query: ",# "Retrieval-document": "title: none | text: ",# "STS": "task: sentence similarity | query: ",# "Summarization": "task: summarization | query: ",# }# Compute semantic textual similarity using texts, so let's use the STS prompttexts = ["The weather is beautiful today.","It's a lovely day outside.","The stock market crashed yesterday.","I enjoy programming with Python."]
embeddings = model.encode(texts, prompt\_name="STS")print(embeddings.shape)# (4, 768)# Compute similaritiessimilarities = model.similarity(embeddings, embeddings)print(similarities)"""tensor([[1.0000, 0.9305, 0.4660, 0.4326],[0.9305, 1.0000, 0.4227, 0.4434],[0.4660, 0.4227, 1.0000, 0.2638],[0.4326, 0.4434, 0.2638, 1.0000]])"""`
```
* [Sentence Transformers`encode`method documentation](https://sbert.net/docs/package_reference/sentence_transformer/SentenceTransformer.html#sentence_transformers.SentenceTransformer.encode)
* [Sentence Transformers`similarity`method documentation](https://sbert.net/docs/package_reference/sentence_transformer/SentenceTransformer.html#sentence_transformers.SentenceTransformer.similarity)Click to see how to truncate embedding dimensionality for faster and cheaper search
Because`google/embeddinggemma-300m`was trained with MRL, the embeddings generated by this model can be truncated to lower dimensionalities without considerably hurting the evaluation performance. Embeddings with lower dimensionalities are both cheaper to store on disk and in memory, as well as faster for downstream tasks like retrieval, clustering, or classification.
In Sentence Transformers, you can set a lower dimensionality using the`truncate\_dim`parameter on either the`SentenceTransformer`initialization or when calling`model.encode`/`model.encode\_query`/`model.encode\_document`:
```
`fromsentence\_transformersimportSentenceTransformer# Download from the ðŸ¤—Hubmodel = SentenceTransformer("google/embeddinggemma-300m", truncate\_dim=256)# Run inference with queries and documentsquery ="Which planet is known as the Red Planet?"documents = ["Venus is often called Earth's twin because of its similar size and proximity.","Mars, known for its reddish appearance, is often referred to as the Red Planet.","Jupiter, the largest planet in our solar system, has a prominent red spot.","Saturn, famous for its rings, is sometimes mistaken for the Red Planet."]
query\_embeddings = model.encode\_query(query)
document\_embeddings = model.encode\_document(documents)print(query\_embeddings.shape, document\_embeddings.shape)# (256,) (4, 256)# Compute similarities to determine a rankingsimilarities = model.similarity(query\_embeddings, document\_embeddings)print(similarities)# tensor([[0.4016, 0.6715, 0.5283, 0.5261]])# Convert similarities to a rankingranking = similarities.argsort(descending=True)[0]print(ranking)# tensor([1, 2, 3, 0])`
```
Note that the ranking is preserved despite using 3x smaller embeddings compared to the full-sized embeddings.
* [Sentence Transformers Matryoshka Embeddings documentation](https://sbert.net/examples/sentence_transformer/training/matryoshka/README.html)### [](#langchain)LangChain
If you prefer, you can also use the LangChain`HuggingFaceEmbeddings`, which uses Sentence Transformers behind the scenes. Note that you'll have to tell LangChain to use the prompts called "query" and "document" for queries and documents, respectively. This example involves a simple information retrieval setup, but the same embedding model can be used in more complex scenarios.
You will need to install the following packages:
```
`pip install git+https://github.com/huggingface/transformers@v4.56.0-Embedding-Gemma-preview
pip install sentence-transformers
pip install langchain
pip install langchain-community
pip install langchain-huggingface
pip install faiss-cpu`
```
```
`fromlangchain.docstore.documentimportDocumentfromlangchain\_community.vectorstoresimportFAISSfromlangchain\_huggingface.embeddingsimportHuggingFaceEmbeddings# Download the model from the ðŸ¤—Hub. Also specify to use the "query" and "document" prompts# as defined in the model configuration, as LangChain doesn't automatically use them.# See https://huggingface.co/google/embeddinggemma-300m/blob/main/config\_sentence\_transformers.jsonembedder = HuggingFaceEmbeddings(
model\_name="google/embeddinggemma-300m",
query\_encode\_kwargs={"prompt\_name":"query"},
encode\_kwargs={"prompt\_name":"document"}
)
data = ["Venus is often called Earth's twin because of its similar size and proximity.","Mars, known for its reddish appearance, is often referred to as the Red Planet.","Jupiter, the largest planet in our solar system, has a prominent red spot.","Saturn, famous for its rings, is sometimes mistaken for the Red Planet."]# Create documents for the vector storedocuments = [Document(page\_content=text, metadata={"id": i})fori, textinenumerate(data)]# Create vector store using FAISS. Setting distance\_strategy to "MAX\_INNER\_PRODUCT" uses# FAISS' FlatIndexIP behind the scenes, which is optimized for inner product search. This# is what the model was trained forvector\_store = FAISS.from\_documents(documents, embedder, distance\_strategy="MAX\_INNER\_PRODUCT")# Search for top 3 similar documentsquery ="Which planet is known as the Red Planet?"results = vector\_store.similarity\_search\_with\_score(query, k=3)# Print resultsfordoc, scoreinresults:print(f"Text:{doc.page\_content}(score:{score:.4f})")"""Text: Mars, known for its reddish appearance, is often referred to as the Red Planet. (score: 0.6359)Text: Jupiter, the largest planet in our solar system, has a prominent red spot. (score: 0.4930)Text: Saturn, famous for its rings, is sometimes mistaken for the Red Planet. (score: 0.4889)"""`
```
* [LangChain HuggingFaceEmbeddings documentation](https://python.langchain.com/api_reference/huggingface/embeddings/langchain_huggingface.embeddings.huggingface.HuggingFaceEmbeddings.html)### [](#llamaindex)LlamaIndex
EmbeddingGemma is also supported in LlamaIndex as it uses Sentence Transformers under the hood. For the correct behaviour, you need to specify the query and document prompts as defined in the model configuration. Otherwise, your performance will be suboptimal. This script shows a rudimentary example of using EmbeddingGemma with LlamaIndex, but you can use the`HuggingFaceEmbedding`class in more difficult settings also.
You will need to install the following packages:
```
`pip install git+https://github.com/huggingface/transformers@v4.56.0-Embedding-Gemma-preview
pip install sentence-transformers
pip install llama-index
pip install llama-index-embeddings-huggingface
pip install llama-index-vector-stores-faiss`
```
```
`importfaissfromllama\_index.core.schemaimportTextNodefromllama\_index.core.vector\_storesimportVectorStoreQueryfromllama\_index.embeddings.huggingfaceimportHuggingFaceEmbeddingfromllama\_index.vector\_stores.faissimportFaissVectorStore# Download from the ðŸ¤—Hub. Also specify the query and document prompts as# defined in the model configuration, as LlamaIndex doesn't automatically load them.# See https://huggingface.co/google/embeddinggemma-300m/blob/main/config\_sentence\_transformers.jsonembeddings = HuggingFaceEmbedding(
model\_name="google/embeddinggemma-300m",
query\_instruction="task: search result | query: ",
text\_instruction="title: none | text: ",
)
data = ["Venus is often called Earth's twin because of its similar size and proximity.","Mars, known for its reddish appearance, is often referred to as the Red Planet.","Jupiter, the largest planet in our solar system, has a prominent red spot.","Saturn, famous for its rings, is sometimes mistaken for the Red Planet."]# Create a sample vector storestore = FaissVectorStore(faiss\_index=faiss.IndexFlatIP(768))
store.add([TextNode(id=i, text=text, embedding=embeddings.get\_text\_embedding(text))fori, textinenumerate(data)])# Search for top k similar documentsquery ="Which planet is known as the Red Planet?"query\_embedding = embeddings.get\_query\_embedding(query)
results = store.query(VectorStoreQuery(query\_embedding=query\_embedding, similarity\_top\_k=3))# Print resultsforidx, scoreinzip(results.ids, results.similarities):print(f"Text:{data[int(idx)]}(score:{score:.4f})")"""Text: Mars, known for its reddish appearance, is often referred to as the Red Planet. (score: 0.6359)Text: Jupiter, the largest planet in our solar system, has a prominent red spot. (score: 0.4930)Text: Saturn, famous for its rings, is sometimes mistaken for the Red Planet. (score: 0.4889)"""`
```
* [LlamaIndex HuggingFaceEmbedding documentation](https://docs.llamaindex.ai/en/stable/examples/embeddings/huggingface/)### [](#haystack)Haystack
EmbeddingGemma can also be used with Haystack, a framework for building production-ready search and language applications. Like LangChain and LlamaIndex, Haystack uses Sentence Transformers behind the scenes and requires you to specify the appropriate prompts. The following example shows how to set up a basic retrieval pipeline using EmbeddingGemma with Haystack.
You will need to install the following packages:
```
`pip install git+https://github.com/huggingface/transformers@v4.56.0-Embedding-Gemma-preview
pip install sentence-transformers
pip install haystack-ai`
```
```
`fromhaystackimportDocument, Pipelinefromhaystack.components.embeddersimportSentenceTransformersDocumentEmbedder, SentenceTransformersTextEmbedderfromhaystack.components.retrieversimportInMemoryEmbeddingRetrieverfromhaystack.document\_stores.in\_memoryimportInMemoryDocumentStore# Initialize the document storedocument\_store = InMemoryDocumentStore()# Initialize the document and query embeddersdocument\_embedder = SentenceTransformersDocumentEmbedder(
model="google/embeddinggemma-300m", encode\_kwargs={"prompt\_name":"document"}
)
query\_embedder = SentenceTransformersTextEmbedder(
model="google/embeddinggemma-300m", encode\_kwargs={"prompt\_name":"query"}
)
document\_embedder.warm\_up()
query\_embedder.warm\_up()
data = ["Venus is often called Earth's twin because of its similar size and proximity.","Mars, known for its reddish appearance, is often referred to as the Red Planet.","Jupiter, the largest planet in our solar system, has a prominent red spot.","Saturn, famous for its rings, is sometimes mistaken for the Red Planet.",
]# Convert to Haystack documents and write to document storedocuments = [Document(content=text,id=str(i))fori, textinenumerate(data)]
documents\_with\_embeddings = document\_embedder.run(documents=documents)["documents"]
document\_store.write\_documents(documents\_with\_embeddings)# Create a query pipeline using a query embedder and compatible retrieverquery\_pipeline = Pipeline()
query\_pipeline.add\_component("text\_embedder", query\_embedder)
query\_pipeline.add\_component("retriever", InMemoryEmbeddingRetriever(document\_store=document\_store, top\_k=3))
query\_pipeline.connect("text\_embedder.embedding","retriever.query\_embedding")# Search for top 3 similar documentsquery ="Which planet is known as the Red Planet?"results = query\_pipeline.run({"text\_embedder": {"text": query}})# Print resultsfordocumentinresults["retriever"]["documents"]:print(f"Text:{document.content}(score:{document.score:.4f})")"""Text: Mars, known for its reddish appearance, is often referred to as the Red Planet. (score: 0.6359)Text: Jupiter, the largest planet in our solar system, has a prominent red spot. (score: 0.4930)Text: Saturn, famous for its rings, is sometimes mistaken for the Red Planet. (score: 0.4889)"""`
```
* [Haystack InMemoryEmbeddingRetriever documentation](https://docs.haystack.deepset.ai/docs/inmemoryembeddingretriever)### [](#txtai)txtai
txtai is also compatible with EmbeddingGemma. Like other frameworks, txtai utilizes Sentence Transformers under the hood and needs the appropriate prompts for optimal performance with EmbeddingGemma. The following example demonstrates how to set up a basic retrieval system with txtai.
You will need to install the following packages:
```
`pip install git+https://github.com/huggingface/transformers@v4.56.0-Embedding-Gemma-preview
pip install sentence-transformers
pip install txtai`
```
```
`fromtxtaiimportEmbeddings# Download from the ðŸ¤—Hub. Also specify the query and document prompts as# defined in the model configuration, as txtai doesn't automatically load them.# See https://huggingface.co/google/embeddinggemma-300m/blob/main/config\_sentence\_transformers.jsonembeddings = Embeddings(
path="google/embeddinggemma-300m",
method="sentence-transformers",
instructions={"query":"task: search result | query: ","data":"title: none | text: ",
}
)
data = ["Venus is often called Earth's twin because of its similar size and proximity.","Mars, known for its reddish appearance, is often referred to as the Red Planet.","Jupiter, the largest planet in our solar system, has a prominent red spot.","Saturn, famous for its rings, is sometimes mistaken for the Red Planet."]# Create a sample vector storeembeddings.index(data)# Search for top k similar documentsquery ="Which planet is known as the Red Planet?"results = embeddings.search(query,3)# Print resultsforidx, scoreinresults:print(f"Text:{data[int(idx)]}(score:{score:.4f})")"""Text: Mars, known for its reddish appearance, is often referred to as the Red Planet. (score: 0.6359)Text: Jupiter, the largest planet in our solar system, has a prominent red spot. (score: 0.4930)Text: Saturn, famous for its rings, is sometimes mistaken for the Red Planet. (score: 0.4889)"""`
```
* [Haystack InMemoryEmbeddingRetriever documentation](https://docs.haystack.deepset.ai/docs/inmemoryembeddingretriever)### [](#transformersjs)Transformers.js
You can even run EmbeddingGemma 100% locally in your browser with[Transformers.js](https://huggingface.co/docs/transformers.js/en/index)! If you haven't already, you can install the library from[NPM](https://www.npmjs.com/package/@huggingface/transformers)using:
```
`npm i @huggingface/transformers`
```
You can then compute embeddings as follows:
```
`import{AutoModel,AutoTokenizer, matmul }from"@huggingface/transformers";// Download from the ðŸ¤—Hubconstmodel\_id ="onnx-community/embeddinggemma-300m-ONNX";consttokenizer =awaitAutoTokenizer.from\_pretrained(model\_id);constmodel =awaitAutoModel.from\_pretrained(model\_id, {dtype:"fp32",// Options: "fp32" | "q8" | "q4"});// Run inference with queries and documentsconstprefixes = {query:"task: search result | query: ",document:"title: none | text: ",
};constquery = prefixes.query+"Which planet is known as the Red Planet?";constdocuments = ["Venus is often called Earth's twin because of its similar size and proximity.","Mars, known for its reddish appearance, is often referred to as the Red Planet.","Jupiter, the largest planet in our solar system, has a prominent red spot.","Saturn, famous for its rings, is sometimes mistaken for the Red Planet.",
].map((x) =&gt;prefixes.document+ x);constinputs =awaittokenizer([query, ...documents], {padding:true});const{ sentence\_embedding } =awaitmodel(inputs);// Compute similarities to determine a rankingconstscores =awaitmatmul(sentence\_embedding, sentence\_embedding.transpose(1,0));constsimilarities = scores.tolist()[0].slice(1);console.log(similarities);// [ 0.30109718441963196, 0.6358831524848938, 0.4930494725704193, 0.48887503147125244 ]// Convert similarities to a rankingconstranking = similarities.map((score, index) =&gt;({ index, score })).sort((a, b) =&gt;b.score- a.score);console.log(ranking);// [// { index: 1, score: 0.6358831524848938 },// { index: 2, score: 0.4930494725704193 },// { index: 3, score: 0.48887503147125244 },// { index: 0, score: 0.30109718441963196 }// ]`
```
### [](#text-embeddings-inference)Text Embeddings Inference
You can easily deploy EmbeddingGemma for both development and production using Text Embeddings Inference (TEI) version[1.8.1](https://github.com/huggingface/text-embeddings-inference/releases/tag/v1.8.1)or later.
* CPU:
```
`docker run -p 8080:80 ghcr.io/huggingface/text-embeddings-inference:cpu-1.8.1 --model-id google/embeddinggemma-300m --dtype float32`
```
* CPU with ONNX Runtime:
```
`docker run -p 8080:80 ghcr.io/huggingface/text-embeddings-inference:cpu-1.8.1 --model-id onnx-community/embeddinggemma-300m-ONNX --dtype float32 --pooling mean`
```
* NVIDIA CUDA:
```
`docker run --gpus all --shm-size 1g -p 8080:80 ghcr.io/huggingface/text-embeddings-inference:cuda-1.8.1 --model-id google/embeddinggemma-300m --dtype float32`
```
> > If you run the Docker container with the `> cuda-1.8.1
`> tag, it includes support for multiple GPU architectures: Turing, Ampere, Ada Lovelace, and Hopper. For a lighter image tailored to just your GPU, you can instead use a specific tag such as `> turing-1.8.1
`> , `> 1.8.1
`> and `> 86-1.8.1
`> (Ampere), `> 89-1.8.1
`> (Ada Lovelace), or `> hopper-1.8.1
`> .
> Once deployed, regardless of the device or runtime, you can leverage the`/v1/embeddings`endpoint based on the[OpenAI Embeddings API Specification](https://platform.openai.com/docs/api-reference/embeddings/create)to generate embeddings.
```
`curl http://0.0.0.0:8080/v1/embeddings -H "Content-Type: application/json" -d '{"model":"google/embeddinggemma-300m","input":["task: search result | query: Which planet is known as the Red Planet?","task: search result | query: Where did Amelia Earhart first fly?"]}'`
```
Alternatively, you can also leverage the`/embed`endpoint from the[Text Embeddings Inference Embeddings API](https://huggingface.github.io/text-embeddings-inference/), which supports the`prompt\_name`parameter, meaning thereâ€™s no need to manually prepend the prompt to the inputs but select it via`prompt\_name`instead.
```
`curl http://0.0.0.0:8080/embed -H "Content-Type: application/json" -d '{"inputs":["Which planet is known as the Red Planet?","Where did Amelia Earthart first fly?"],"prompt\_name":"query","normalize":true}'`
```
> > Additionally, note that since `> google/embeddinggemma-300m
`> was trained with [> Matryoshka Representation Learning (MRL)
](https://huggingface.co/blog/matryoshka)> , you can also leverage the `> dimensions
`> parameter, on both `> /v1/embeddings
`> and `> /embed
`> , to truncate the embeddings to lower dimensionalities (512, 256, and 128) without hurting the evaluation performance.
> ### [](#onnx-runtime)ONNX Runtime
You can also run the model directly with[ONNX Runtime](https://onnxruntime.ai/), making it highly portable and cross-platform compatible. The example below shows usage in Python, but the same approach can be applied in other languages (Java, C#, C++, etc.) as well.
```
`fromhuggingface\_hubimporthf\_hub\_downloadimportonnxruntimeasortfromtransformersimportAutoTokenizer# Download from the ðŸ¤—Hubmodel\_id ="onnx-community/embeddinggemma-300m-ONNX"model\_path = hf\_hub\_download(model\_id, subfolder="onnx", filename="model.onnx")# Download graphhf\_hub\_download(model\_id, subfolder="onnx", filename="model.onnx\_data")# Download weightssession = ort.InferenceSession(model\_path)
tokenizer = AutoTokenizer.from\_pretrained(model\_id)# Run inference with queries and documentsprefixes = {"query":"task: search result | query: ","document":"title: none | text: ",
}
query = prefixes["query"] +"Which planet is known as the Red Planet?"documents = ["Venus is often called Earth's twin because of its similar size and proximity.","Mars, known for its reddish appearance, is often referred to as the Red Planet.","Jupiter, the largest planet in our solar system, has a prominent red spot.","Saturn, famous for its rings, is sometimes mistaken for the Red Planet."]
documents = [prefixes["document"] + xforxindocuments]
inputs = tokenizer([query] + documents, padding=True, return\_tensors="np")
\_, sentence\_embedding = session.run(None, inputs.data)print(sentence\_embedding.shape)# (5, 768)# Compute similarities to determine a rankingquery\_embeddings = sentence\_embedding[0]
document\_embeddings = sentence\_embedding[1:]
similarities = query\_embeddings @ document\_embeddings.Tprint(similarities)# [0.30109745 0.635883 0.49304956 0.48887485]# Convert similarities to a rankingranking = similarities.argsort()[::-1]print(ranking)# [1 2 3 0]`
```
## [](#finetuning)Finetuning
As with all models compatible with the Sentence Transformers library, EmbeddingGemma can be easily fine-tuned on your specific dataset. To showcase this, we'll be finetuning`google/embeddinggemma-300m`on the[Medical Instruction and RetrIeval Dataset (MIRIAD)](https://huggingface.co/datasets/miriad/miriad-4.4M)dataset, such that our finetuned model becomes particularly adept at finding passages up to 1000 tokens from scientific medical papers given detailed medical questions. These passages can be used as crucial context for a generative model to answer questions more effectively.
Below, you can explore each key component of the finetuning process using expandable tabs. Each tab contains the relevant code and a detailed explanation.
Model
```
`fromsentence\_transformersimportSentenceTransformer, SentenceTransformerModelCardData
model = SentenceTransformer("google/embeddinggemma-300m",
model\_card\_data=SentenceTransformerModelCardData(
language="en",
license="apache-2.0",
model\_name="EmbeddingGemma-300m trained on the Medical Instruction and RetrIeval Dataset (MIRIAD)",
),
)# SentenceTransformer(# (0): Transformer({'max\_seq\_length': 1024, 'do\_lower\_case': False, 'architecture': 'Gemma3TextModel'})# (1): Pooling({'word\_embedding\_dimension': 768, 'pooling\_mode\_cls\_token': False, 'pooling\_mode\_mean\_tokens': True, 'pooling\_mode\_max\_tokens': False, 'pooling\_mode\_mean\_sqrt\_len\_tokens': False, 'pooling\_mode\_weightedmean\_tokens': False, 'pooling\_mode\_lasttoken': False, 'include\_prompt': True})# (2): Dense({'in\_features': 768, 'out\_features': 3072, 'bias': False, 'activation\_function': 'torch.nn.modules.linear.Identity'})# (3): Dense({'in\_features': 3072, 'out\_features': 768, 'bias': False, 'activation\_function': 'torch.nn.modules.linear.Identity'})# (4): Normalize()# )`
```
This code loads the EmbeddingGemma model from Hugging Face, with optional model card metadata for documentation and sharing. The`SentenceTransformer`class loads the model weights and configuration, while the`model\_card\_data`argument attaches metadata useful for inclusion in the automatically generated model card.
* Documentation:[Sentence Transformers &gt; Training Overview &gt; Model](https://sbert.net/docs/sentence_transformer/training_overview.html#model)Dataset
```
`fromdatasetsimportload\_dataset
train\_dataset = load\_dataset("tomaarsen/miriad-4.4M-split", split="train").select(range(100\_000))
eval\_dataset = load\_dataset("tomaarsen/miriad-4.4M-split", split="eval").select(range(1\_000))
test\_dataset = load\_dataset("tomaarsen/miriad-4.4M-split", split="test").select(range(1\_000))# Dataset({# features: ['question', 'passage\_text'],# num\_rows: 100000# })# Dataset({# features: ['question', 'passage\_text'],# num\_rows: 1000# })# Dataset({# features: ['question', 'passage\_text'],# num\_rows: 1000# })`
```
This code loads the[MIRIAD dataset](https://huggingface.co/datasets/miriad/miriad-4.4M), or rather, a[copy](https://huggingface.co/datasets/tomaarsen/miriad-4.4M-split)that has been divided into train, eval, and test splits. Using a large, high-quality dataset ensures the model learns meaningful representations, while subsetting allows for faster experimentation. The`load\_dataset`function fetches the dataset from Hugging Face Datasets, and the`.select()`method limits the number of samples for each split.
* Documentation:[Sentence Transformers &gt; Training Overview &gt; Dataset](https://sbert.net/docs/sentence_transformer/training_overview.html#dataset)Loss Function
```
`fromsentence\_transformers.lossesimportCachedMultipleNegativesRankingLoss
loss = CachedMultipleNegativesRankingLoss(model, mini\_batch\_size=8)`
```
This code defines the loss function for training, using[Cached Multiple Negatives Ranking Loss (CMNRL)](https://sbert.net/docs/package_reference/sentence_transformer/losses.html#sentence_transformers.losses.CachedMultipleNegativesRankingLoss). CMNRL is effective for retrieval tasks, as it uses in-batch negatives to efficiently train the model to distinguish between correct and incorrect pairs. The loss takes question-answer pairs and treats other answers in the batch as negatives, maximizing the distance between unrelated pairs in the embedding space. The`mini\_batch\_size`parameter controls the memory usage, but does not affect the training dynamics.
It's recommended to use this loss with a large`per\_device\_train\_batch\_size`in`SentenceTransformerTrainingArguments`and a low`mini\_batch\_size`in`CachedMultipleNegativesRankingLoss`for a strong training signal with low memory usage. Additionally, the[`NO\_DUPLICATES`batch sampler](https://sbert.net/docs/package_reference/sentence_transformer/sampler.html#sentence_transformers.training_args.BatchSamplers)is recommended to avoid accidental false negatives.
* Documentation:[Sentence Transformers &gt; Training Overview &gt; Loss Function](https://sbert.net/docs/sentence_transformer/training_overview.html#loss-function)Training Arguments
```
`fromsentence\_transformers.training\_argsimportBatchSamplersfromsentence\_transformersimportSentenceTransformerTrainingArguments
run\_name ="embeddinggemma-300m-medical-100k"args = SentenceTransformerTrainingArguments(
output\_dir=f"models/{run\_name}",
num\_train\_epochs=1,
per\_device\_train\_batch\_size=128,
per\_device\_eval\_batch\_size=128,
learning\_rate=2e-5,
warmup\_ratio=0.1,
fp16=True,# Set to False if your GPU can't run FP16bf16=False,# Set to True if your GPU supports BF16batch\_sampler=BatchSamplers.NO\_DUPLICATES,
prompts={"question": model.prompts["query"],"passage\_text": model.prompts["document"],
},
eval\_strategy="steps",
eval\_steps=100,
save\_strategy="steps",
save\_steps=100,
save\_total\_limit=2,
logging\_steps=20,
run\_name=run\_name,
)`
```
This code sets up all hyperparameters and configuration for training, evaluation, and logging. Proper training arguments are crucial for efficient, stable, and reproducible training. The arguments control batch sizes, learning rate, mixed precision, evaluation and saving frequency, and more. Notably, the`prompts`dictionary maps dataset columns to prompts used by the model to distinguish queries from documents.
* Documentation:[Sentence Transformers &gt; Training Overview &gt; Training Arguments](https://sbert.net/docs/sentence_transformer/training_overview.html#training-arguments)Evaluator
```
`fromsentence\_transformers.evaluationimportInformationRetrievalEvaluator
queries =dict(enumerate(eval\_dataset["question"]))
corpus =dict(enumerate(eval\_dataset["passage\_text"] + train\_dataset["passage\_text"][:30\_000]))
relevant\_docs = {idx: [idx]foridxinqueries}
dev\_evaluator = InformationRetrievalEvaluator(
queries=queries,
corpus=corpus,
relevant\_docs=relevant\_docs,
name="miriad-eval-1kq-31kd",
show\_progress\_bar=True,
)
dev\_evaluator(model)`
```
This code sets up an evaluator for information retrieval, using queries and a corpus to measure model performance. Evaluation during training helps monitor progress and avoid overfitting. The evaluator computes retrieval metrics (NDCG, MRR, Recall, Precision, MAP, etc.) by checking if the model retrieves the correct passages for each query. It can be run before, during, and after training, and the results will be logged and incorporated in the automatically generated model card.
Note that this snippet in particular uses all (1k) evaluation questions against a corpus of all (1k) evaluation passages and 30k training passages, for a total of 31k documents. Evaluating only against evaluation passages is too simple for the model.
* Documentation:[Sentence Transformers &gt; Training Overview &gt; Evaluator](https://sbert.net/docs/sentence_transformer/training_overview.html#evaluator)Trainer
```
`fromsentence\_transformersimportSentenceTransformerTrainer
trainer = SentenceTransformerTrainer(
model=model,
args=args,
train\_dataset=train\_dataset,
eval\_dataset=eval\_dataset,
loss=loss,
evaluator=dev\_evaluator,
)
trainer.train()`
```
This code initializes and runs the training loop, coordinating all components.
* Documentation:[Sentence Transformers &gt; Training Overview &gt; Trainer](https://sbert.net/docs/sentence_transformer/training_overview.html#trainer)
### [](#full-finetuning-script)Full Finetuning Script
Below is the complete script, combining all components above:
```
`importloggingimporttracebackfromdatasetsimportload\_datasetfromsentence\_transformersimport(
SentenceTransformer,
SentenceTransformerModelCardData,
SentenceTransformerTrainer,
SentenceTransformerTrainingArguments,
)fromsentence\_transformers.evaluationimportInformationRetrievalEvaluatorfromsentence\_transformers.lossesimportCachedMultipleNegativesRankingLossfromsentence\_transformers.training\_argsimportBatchSamplers# Set the log level to INFO to get more informationlogging.basicConfig(format="%(asctime)s - %(message)s", datefmt="%Y-%m-%d %H:%M:%S", level=logging.INFO)# 1. Load a model to finetune with 2. (Optional) model card datamodel = SentenceTransformer("google/embeddinggemma-300m",
model\_card\_data=SentenceTransformerModelCardData(
language="en",
license="apache-2.0",
model\_name="EmbeddingGemma-300m trained on the Medical Instruction and RetrIeval Dataset (MIRIAD)",
),
)# 3. Load a dataset to finetune ontrain\_dataset = load\_dataset("tomaarsen/miriad-4.4M-split", split="train").select(range(100\_000))
eval\_dataset = load\_dataset("tomaarsen/miriad-4.4M-split", split="eval").select(range(1\_000))
test\_dataset = load\_dataset("tomaarsen/miriad-4.4M-split", split="test").select(range(1\_000))# 4. Define a loss function. CachedMultipleNegativesRankingLoss (CMNRL) is a special variant of MNRL (a.k.a. InfoNCE),# which take question-answer pairs (or triplets, etc.) as input. It will take answers from other questions in the batch# as wrong answers, reducing the distance between the question and the true answer while increasing the distance to the# wrong answers, in the embedding space.# The (C)MNRL losses benefit from larger `per\_device\_train\_batch\_size` in the Training Arguments, as they can leverage# more in-batch negative samples. At the same time, the `mini\_batch\_size` does not affect training performance, but it# does limit the memory usage. A good trick is setting a high `per\_device\_train\_batch\_size` while keeping# `mini\_batch\_size` small.loss = CachedMultipleNegativesRankingLoss(model, mini\_batch\_size=8)# 5. (Optional) Specify training argumentsrun\_name ="embeddinggemma-300m-medical-100k"args = SentenceTransformerTrainingArguments(# Required parameter:output\_dir=f"models/{run\_name}",# Optional training parameters:num\_train\_epochs=1,
per\_device\_train\_batch\_size=128,
per\_device\_eval\_batch\_size=128,
learning\_rate=2e-5,
warmup\_ratio=0.1,
fp16=True,# Set to False if you get an error that your GPU can't run on FP16bf16=False,# Set to True if you have a GPU that supports BF16batch\_sampler=BatchSamplers.NO\_DUPLICATES,# (Cached)MultipleNegativesRankingLoss benefits from no duplicate samples in a batchprompts={# Map training column names to model prompts"question": model.prompts["query"],"passage\_text": model.prompts["document"],
},# Optional tracking/debugging parameters:eval\_strategy="steps",
eval\_steps=100,
save\_strategy="steps",
save\_steps=100,
save\_total\_limit=2,
logging\_steps=20,
run\_name=run\_name,# Will be used in W&amp;B if `wandb` is installed)# 6. (Optional) Create an evaluator using the evaluation queries and 31k answers &amp; evaluate the base modelqueries =dict(enumerate(eval\_dataset["question"]))
corpus =dict(enumerate(eval\_dataset["passage\_text"] + train\_dataset["passage\_text"][:30\_000]))
relevant\_docs = {idx: [idx]foridxinqueries}
dev\_evaluator = InformationRetrievalEvaluator(
queries=queries,
corpus=corpus,
relevant\_docs=relevant\_docs,
name="miriad-eval-1kq-31kd",# 1k questions, 31k passagesshow\_progress\_bar=True,
)
dev\_evaluator(model)# 7. Create a trainer &amp; traintrainer = SentenceTransformerTrainer(
model=model,
args=args,
train\_dataset=train\_dataset,
eval\_dataset=eval\_dataset,
loss=loss,
evaluator=dev\_evaluator,
)
trainer.train()# (Optional) Evaluate the trained model on the evaluation set once more, this will also log the results# and include them in the model carddev\_evaluator(model)
queries =dict(enumerate(test\_dataset["question"]))
corpus =dict(enumerate(test\_dataset["passage\_text"] + train\_dataset["passage\_text"][:30\_000]))
relevant\_docs = {idx: [idx]foridxinqueries}
test\_evaluator = InformationRetrievalEvaluator(
queries=queries,
corpus=corpus,
relevant\_docs=relevant\_docs,
name="miriad-test-1kq-31kd",# 1k questions, 31k passagesshow\_progress\_bar=True,
)
test\_evaluator(model)# 8. Save the trained modelfinal\_output\_dir =f"models/{run\_name}/final"model.save\_pretrained(final\_output\_dir)# 9. (Optional) Push it to the Hugging Face Hub# It is recommended to run `huggingface-cli login` to log into your Hugging Face account firsttry:
model.push\_to\_hub(run\_name)exceptException:
logging.error(f"Error uploading model to the Hugging Face Hub:\\n{traceback.format\_exc()}To upload it manually, you can run "f"`huggingface-cli login`, followed by loading the model using `model = SentenceTransformer({final\_output\_dir!r})` "f"and saving it using `model.push\_to\_hub('{run\_name}')`.")`
```
### [](#training)Training
We ran the full training script on an RTX 3090 with 24GB of VRAM, and the completed training and evaluating scripts took 5.5 hours. If desired, you can further reduce the memory footprint by reducing`mini\_batch\_size`on the`CachedMultipleNegativesRankingLoss`and`batch\_size`on the`InformationRetrievalEvaluator`instances. See here the logs from our training run:
|Epoch|Step|Training Loss|Validation Loss|miriad-eval-1kq-31kd\_cosine\_ndcg@10|miriad-test-1kq-31kd\_cosine\_ndcg@10|
-1|-1|-|-|0.8474|0.8340|
0.0256|20|0.1019|-|-|-|
0.0512|40|0.0444|-|-|-|
0.0767|60|0.0408|-|-|-|
0.1023|80|0.0462|-|-|-|
0.1279|100|0.0542|0.0525|0.8616|-|
0.1535|120|0.0454|-|-|-|
0.1790|140|0.0403|-|-|-|
0.2046|160|0.0463|-|-|-|
0.2302|180|0.0508|-|-|-|
0.2558|200|0.0497|0.0449|0.8643|-|
0.2813|220|0.0451|-|-|-|
0.3069|240|0.0445|-|-|-|
0.3325|260|0.0489|-|-|-|
0.3581|280|0.0452|-|-|-|
0.3836|300|0.0461|0.0406|0.8832|-|
0.4092|320|0.0415|-|-|-|
0.4348|340|0.04|-|-|-|
0.4604|360|0.0399|-|-|-|
0.4859|380|0.0423|-|-|-|
0.5115|400|0.0352|0.0316|0.8823|-|
0.5371|420|0.0408|-|-|-|
0.5627|440|0.0356|-|-|-|
0.5882|460|0.0371|-|-|-|
0.6138|480|0.0276|-|-|-|
0.6394|500|0.028|0.0280|0.8807|-|
0.6650|520|0.0302|-|-|-|
0.6905|540|0.0345|-|-|-|
0.7161|560|0.0325|-|-|-|
0.7417|580|0.033|-|-|-|
0.7673|600|0.0314|0.0264|0.8910|-|
0.7928|620|0.033|-|-|-|
0.8184|640|0.029|-|-|-|
0.8440|660|0.0396|-|-|-|
0.8696|680|0.0266|-|-|-|
0.8951|700|0.0262|0.0240|0.8968|-|
0.9207|720|0.0262|-|-|-|
0.9463|740|0.0327|-|-|-|
0.9719|760|0.0293|-|-|-|
0.9974|780|0.0304|-|-|-|
-1|-1|-|-|0.9026|0.8862|
### [](#finetuned-evaluation)Finetuned Evaluation
The performance of the base model was already excellent, with a strong 0.8340 NDCG@10 on our MIRIAD test set. Despite that, we were able to increase it considerably on this domain-specific dataset.
|Model|Number of Parameters|NDCG@10 on`miriad-test-1kq-31kd`|
[`BAAI/bge-base-en-v1.5`](https://huggingface.co/BAAI/bge-base-en-v1.5)|109M|0.7541|
[`intfloat/multilingual-e5-small`](https://huggingface.co/intfloat/multilingual-e5-small)|118M|0.6852|
[`ibm-granite/granite-embedding-125m-english`](https://huggingface.co/ibm-granite/granite-embedding-125m-english)|125M|0.7745|
[`Snowflake/snowflake-arctic-embed-m-long`](https://huggingface.co/Snowflake/snowflake-arctic-embed-m-long)|137M|0.7514|
[`intfloat/multilingual-e5-base`](https://huggingface.co/intfloat/multilingual-e5-base)|278M|0.7052|
[`Snowflake/snowflake-arctic-embed-m-v2.0`](https://huggingface.co/Snowflake/snowflake-arctic-embed-m-v2.0)|305M|0.8467|
[`BAAI/bge-large-en-v1.5`](https://huggingface.co/BAAI/bge-large-en-v1.5)|335M|0.7727|
[`mixedbread-ai/mxbai-embed-large-v1`](https://huggingface.co/mixedbread-ai/mxbai-embed-large-v1)|335M|0.7851|
[`intfloat/multilingual-e5-large`](https://huggingface.co/intfloat/multilingual-e5-large)|560M|0.7318|
[`Snowflake/snowflake-arctic-embed-l-v2.0`](https://huggingface.co/Snowflake/snowflake-arctic-embed-l-v2.0)|568M|0.8433|
[`Qwen/Qwen3-Embedding-0.6B`](https://huggingface.co/Qwen/Qwen3-Embedding-0.6B)|596M|0.8493|
|||
[`google/embeddinggemma-300m`](https://huggingface.co/google/embeddinggemma-300m)(base)|268M|0.8340|
[`sentence-transformers/embeddinggemma-300m-medical`](https://huggingface.co/sentence-transformers/embeddinggemma-300m-medical)(fine-tuned)|268M|**0.8862**|
Our fine-tuning process achieved a significant improvement of +0.0522 NDCG@10 on the test set, resulting in a model that comfortably outperforms any existing general-purpose embedding model on our specific task, at this model size. Additional time and compute investment would allow for even stronger results, such as[hard negatives mining](https://sbert.net/docs/package_reference/util.html#sentence_transformers.util.mine_hard_negatives)or training with more than 100k data pairs.
## [](#further-reading)Further Reading
* [google/embeddinggemma-300m](https://huggingface.co/google/embeddinggemma-300m)
* [Google EmbeddingGemma blogpost](https://developers.googleblog.com/en/introducing-embeddinggemma/)
* [Google EmbeddingGemma technical report](https://arxiv.org/abs/2509.20354)
* [Sentence Transformers documentation](https://sbert.net/)
* [Sentence Transformers &gt; Training Overview documentation](https://sbert.net/docs/sentence_transformer/training_overview.html)
* [Transformers.js documentation](https://huggingface.co/docs/transformers.js/en/index)
* [Text Embeddings Inference (TEI) documentation](https://huggingface.co/docs/text-embeddings-inference/en/index)
More Articles from our Blog
[
![](https://huggingface.co/blog/assets/train-sentence-transformers/st-hf-thumbnail.png)
nlpguidecommunity
## Training and Finetuning Sparse Embedding Models with Sentence Transformers v5
* ![](https://cdn-avatars.huggingface.co/v1/production/uploads/6317233cc92fd6fee317e030/cJHSvvimr1kqgQfHOjO5n.png)
* ![](https://cdn-avatars.huggingface.co/v1/production/uploads/663ce8bfc6827e9ba288eed4/0xrGyvLOq8DtP4TQsesnS.jpeg)
* 132
July 1, 2025
](https://huggingface.co/blog/train-sparse-encoder)
[
![](https://huggingface.co/blog/assets/train-sentence-transformers/st-hf-thumbnail.png)
nlpguidecommunity
## Training and Finetuning Reranker Models with Sentence Transformers v4
* ![](https://cdn-avatars.huggingface.co/v1/production/uploads/6317233cc92fd6fee317e030/cJHSvvimr1kqgQfHOjO5n.png)
* 177
March 26, 2025
](https://huggingface.co/blog/train-reranker)
### Community
![](https://cdn-avatars.huggingface.co/v1/production/uploads/61f3e7560d42e7d665ceead4/r8CUFXIqLC_4KXmCl9mg0.jpeg)
[yusufcakmak](https://huggingface.co/yusufcakmak)
[Sep 7](#68bda75326975fa834fd6698)
Great post well done ðŸ‘ðŸ»I have a quick question. Can you please share the package versions for training? For example I needed to update my torch version to torch&gt;=2.6.
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/6317233cc92fd6fee317e030/cJHSvvimr1kqgQfHOjO5n.png)](https://huggingface.co/tomaarsen)
* 1 replyÂ·
![](https://cdn-avatars.huggingface.co/v1/production/uploads/6317233cc92fd6fee317e030/cJHSvvimr1kqgQfHOjO5n.png)
[tomaarsen](https://huggingface.co/tomaarsen)
Article author[Sep 7](#68bda82c746e6ec57c83b42e)
Great question, you should be using:
```
`pip install git+https://github.com/huggingface/transformers
pip install sentence-transformers&gt;=5.0.0
pip install torch&gt;=2.6.0`
```
Until the next transformers version is out, then you can start using that.
For context, these are the versions that I was using:[https://huggingface.co/sentence-transformers/embeddinggemma-300m-medical#framework-versions](https://huggingface.co/sentence-transformers/embeddinggemma-300m-medical#framework-versions)
* Tom Aarsen
ðŸ‘5
5
â¤ï¸4
4
+
![](https://cdn-avatars.huggingface.co/v1/production/uploads/653ed148aa1f487614f4ffdc/EFTSCIHtZ-4ihwX-FmupR.jpeg)
[umurotti](https://huggingface.co/umurotti)
[Sep 8](#68bf45a8f0e6af1e35d0b57e)
â€¢[edited Sep 8](#68bf45a8f0e6af1e35d0b57e)
Thank you for publishing the work!
When I try to quickly run the semantic galaxy demo on my browser (Firefox)I get the following error:
Error: no available backend found. ERR: [wasm] [object ErrorEvent]
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/61b253b7ac5ecaae3d1efe0c/hwiQ0uvz3t-L5a-NtBIO6.png)](https://huggingface.co/Xenova)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/653ed148aa1f487614f4ffdc/EFTSCIHtZ-4ihwX-FmupR.jpeg)](https://huggingface.co/umurotti)
* 2 repliesÂ·
![](https://cdn-avatars.huggingface.co/v1/production/uploads/61b253b7ac5ecaae3d1efe0c/hwiQ0uvz3t-L5a-NtBIO6.png)
[Xenova](https://huggingface.co/Xenova)
Article author[Sep 9](#68c04dbb9479bea07294aa1e)
Hi[@umurotti](https://huggingface.co/umurotti)! Thanks for the report. This error occurred on browsers without WebGPU support. I identified and fixed the error, so could you try again?
[![image.png](https://cdn-uploads.huggingface.co/production/uploads/61b253b7ac5ecaae3d1efe0c/rbdK92vArqbO5dX7TFvcj.png)](https://cdn-uploads.huggingface.co/production/uploads/61b253b7ac5ecaae3d1efe0c/rbdK92vArqbO5dX7TFvcj.png)
â¤ï¸3
3
+
Expand 1
reply
![](https://cdn-avatars.huggingface.co/v1/production/uploads/no-auth/49RUH5ONa4-us0_PNOQGL.png)
[MayankBitcot](https://huggingface.co/MayankBitcot)
[Sep 10](#68c14d5366b268600b9856aa)
Is there any documentation to use this model in android device?
âž•2
2
+
Reply
![](https://cdn-avatars.huggingface.co/v1/production/uploads/no-auth/Jdvib27HAIQLEWyo2Y4p-.png)
[etiennekintzler](https://huggingface.co/etiennekintzler)
[Sep 16](#68c95a513f17905bd7b0edb3)
â€¢[edited Sep 17](#68c95a513f17905bd7b0edb3)
The sagemaker deployment ([https://huggingface.co/google/embeddinggemma-300m?sagemaker\_deploy=true](https://huggingface.co/google/embeddinggemma-300m?sagemaker_deploy=true)) is not working because it uses hugging-face tei version 1.8.0 (while it should be &gt;=1.8.1 as the article mentions):
```
`"Could not start Candle backend: Could not start backend: Model is not supported\\n\\nCaused by:\\n unknown variant `gemma3\_text`, expected one of `bert`, `xlm-roberta`, `camembert`, `roberta`, `distilbert`, `nomic\_bert`, `mistral`, `gte`, `new`, `qwen2`, `qwen3`, `mpnet`, `modernbert` at line 45 column 29"`
```
But if I use`image\_uri=get\_huggingface\_llm\_image\_uri("huggingface-tei", version="1.8.1")`it errors because the current version of sagemaker (2.251.1) does not support huggingface-tei version 1.8.1 (it only supports 1.8.0).
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/60f0608166e5701b80ed3f02/BHso-wSWpR9b8b8CKvodC.jpeg)](https://huggingface.co/alvarobartt)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/noauth/w3Z6xyKVBA6np65Tb16dP.jpeg)](https://huggingface.co/pagezyhf)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/no-auth/Jdvib27HAIQLEWyo2Y4p-.png)](https://huggingface.co/etiennekintzler)
* 3 repliesÂ·
ðŸ‘2
2
+
![](https://cdn-avatars.huggingface.co/v1/production/uploads/60f0608166e5701b80ed3f02/BHso-wSWpR9b8b8CKvodC.jpeg)
[alvarobartt](https://huggingface.co/alvarobartt)
Article author[Sep 16](#68c981140fe509253a3aeb78)
Hey[@etiennekintzler](https://huggingface.co/etiennekintzler)thanks for flagging! Indeed we're working close with the AWS SageMaker team on releasing those, we'll ping you once released but should be soon ðŸ¤—â¤ï¸1
1
+
Expand 2
replies
![](https://cdn-avatars.huggingface.co/v1/production/uploads/no-auth/yrDWuiWafiL5ttsLa5LPV.png)
[mmalam786](https://huggingface.co/mmalam786)
[Oct 9](#68e7004adb9d1ebd3f22589e)
EmbeddingGemma looks really promising â€”especially the focus on efficiency. In my own experiments, I quantized DistilBERT (SST-2) into an int8 ONNX model and saw latency reductions of around 20â€“30% with almost no accuracy drop. Iâ€™m curious if the team has explored quantization-aware training (QAT) for EmbeddingGemma, or if post-training quantization is sufficient to maintain embedding quality? Hereâ€™s my demo repo for reference:[https://www.linkedin.com/posts/dr-mm-alam-93991120b\_demofirst-aichips-edgeai-activity-7381674484098883584-0Rwn/?utm\_source=share&amp;&amp;utm\_medium=member\_desktop&amp;&amp;rcm=ACoAADVZuP0BheDJgKL8dWk-bNo7Yd4zhsOnNL4](https://www.linkedin.com/posts/dr-mm-alam-93991120b_demofirst-aichips-edgeai-activity-7381674484098883584-0Rwn/?utm_source=share&amp;utm_medium=member_desktop&amp;rcm=ACoAADVZuP0BheDJgKL8dWk-bNo7Yd4zhsOnNL4)
Reply
deleted
[18 days ago](#692e305a5f0bc7f1bb237702)
This comment has been hidden
EditPreview
Upload images, audio, and videos by dragging in the text input, pasting, orclicking here.
Tap or paste here to upload images
Comment
Â·[Sign up](https://huggingface.co/join?next=/blog/embeddinggemma)or[log in](https://huggingface.co/login?next=/blog/embeddinggemma)to comment
[
Upvote
266
](https://huggingface.co/login?next=/blog/embeddinggemma)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1642412329881-5e6b7a61d4cd9779932a7601.png)](https://huggingface.co/loretoparisi)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1594214747713-5e9ecfc04957053f60648a3e.png)](https://huggingface.co/lhoestq)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1590676895158-noauth.jpeg)](https://huggingface.co/rahulbana)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1591114977477-noauth.png)](https://huggingface.co/davidmezzetti)
* [![](https://huggingface.co/avatars/5aec4a666b524d0ca052fb82c45a0d25.svg)](https://huggingface.co/kalyan-ks)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/5f106ce5348d4c7346cd19ab/Uu08yZZlFuj3dtG4wld3n.jpeg)](https://huggingface.co/abdullah)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/5f17f0a0925b9863e28ad517/fXIY5i9RLsIa1v3CCuVtt.jpeg)](https://huggingface.co/victor)
* [![](https://huggingface.co/avatars/a67bd01cf25516d6b5f7ebd3693072bb.svg)](https://huggingface.co/ashish)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/5f43448a79c1ba4c353d0d8f/DiSygV3dn7A_OjmGVTrHD.jpeg)](https://huggingface.co/sugatoray)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1670088855038-5f5a3f689c5d501a5077e825.jpeg)](https://huggingface.co/mikr)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1649681653581-5f7fbd813e94f16a85448745.jpeg)](https://huggingface.co/sayakpaul)
* [![](https://cdn-avatars.huggingface.co/v1/production/uploads/1605114051380-noauth.jpeg)](https://huggingface.co/jeffboudier)
* +254
