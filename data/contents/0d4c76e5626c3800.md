# How to build AI agents with MCP: 12 framework comparison (2025)

**URL:** https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks
**Published:** 2025-10-13T00:00:00.000Z

---

## Summary

The webpage provides a comparison of 12 major AI agent SDKs and frameworks that support the **Model Context Protocol (MCP)**, which standardizes how applications interact with LLMs and their tools.

The summary relevant to your query is:

The article discusses **Agent SDKs** as building blocks for agentic experiences, often providing boilerplate for integrating with **MCP servers**. It lists and compares 12 frameworks with MCP support, including:

*   **LangChain** and **LlamaIndex** (noted for ecosystem breadth and data-aware applications/RAG, respectively).
*   **OpenAI Agents SDK** (for delegation patterns).
*   **Claude Agent SDK** (for security-first production, requiring explicit tool allowlists).
*   **CrewAI** (for multi-agent workflows).
*   **Google Agent Development Kit** (supports Java).
*   **DSPy** (for automatic prompt optimization).
*   **PydanticAI** (for type safety and data validation).
*   **mcp-agent** (inspired by Anthropic patterns).
*   **Agno** (for speed and minimal boilerplate).
*   **Microsoft Agent Framework** (for Azure integration).
*   **Upsonic** (targeted toward the financial sector).

The text also explains that **MCP servers** define sets of tools LLMs can interact with, similar to REST APIs but standardized for LLM tool usage. It touches upon concepts like **function calling** (noting MCP is model-agnostic while function calling is model-specific) and mentions that frameworks handle complexities like tool discovery and message passing.

**Regarding other specific terms in your query:**

*   **Agent memory, agentic memory, context compression, long context:** These advanced concepts are not explicitly detailed or compared across the frameworks in this summary, although frameworks like LangChain and LlamaIndex are generally associated with managing context and data retrieval (RAG).
*   **Agent orchestration:** Mentioned in the context of CrewAI (multi-agent workflows) and Google ADK.
*   **Agent evaluations, LLM reasoning trace evaluation:** Not explicitly covered as a feature comparison point for the listed frameworks.
*   **Prompt engineering, context engineering:** DSPy is highlighted for automatic prompt optimization.
*   **Supervised fine-tuning, reinforcement learning:** These advanced training methods are not discussed in relation to the

---

## Full Content

How to build AI agents with MCP: 12 framework comparison (2025)
[![ClickHouse logo](https://clickhouse.com/_next/static/media/logo-full.ac8102d5.svg)](https://clickhouse.com/)Open search
Open region selector
* [English](https://clickhouse.com/?country=en)
* [Japanese](https://clickhouse.com/jp?country=jp)
Open menu
Open search
Open region selector
* [English](https://clickhouse.com/?country=en)
* [Japanese](https://clickhouse.com/jp?country=jp)
[44.9k](https://github.com/ClickHouse/ClickHouse?utm_source=clickhouse&amp;utm_medium=website&amp;utm_campaign=website-nav)[Sign in](https://console.clickhouse.cloud/signIn)[Get started](https://console.clickhouse.cloud/signUp?loc=nav-get-started)
-&gt;Scroll to top
Back
* [Blog](https://clickhouse.com/blog)
* /
* [Community](https://clickhouse.com/blog?category=community)
Copy pageCopied!More actions
* ![View as Markdown](https://clickhouse.com/_next/static/media/icon-markdown.c048adbf.svg)**View as Markdown**Open this page in Markdown
* ![Open in ChatGPT](https://clickhouse.com/_next/static/media/icon-chatgpt.f6a7ebb4.svg)**Open in ChatGPT**Ask questions about this page
* ![Open in Claude](https://clickhouse.com/_next/static/media/icon-claude.18912ab9.svg)**Open in Claude**Ask questions about this page
* ![Open in v0](https://clickhouse.com/_next/static/media/icon-v0.2caf962b.svg)**Open in v0**Ask questions about this page
# How to build AI agents with MCP: 12 framework comparison (2025)
![Al Brown](https://clickhouse.com/_next/image?url=%2Fuploads%2Fal_brown_headshot_09ae0cbce6.jpg&amp;w=96&amp;q=75)![](https://clickhouse.com/_next/image?url=%2Fuploads%2Fmark_needham_a17c08008e.png&amp;w=96&amp;q=75)
Al Brown, Mark Needham
Oct 13, 2025-33minutes read
> **> TL;DR
**
> Building AI agents with MCP? There are now (at least) **> 12 major agent SDKs
**> with MCP support.
> Each framework has different strengths: **> Claude Agent SDK
**> for security-first production, **> OpenAI Agents SDK
**> for delegation patterns, **> CrewAI
**> for multi-agent workflows, **> LangChain
**> for ecosystem breadth, **> Agno
**> for minimal code, **> DSPy
**> for prompt optimization, and more.
**> We have a look at each of the frameworks and include code for interacting with a Model Context Protocol (MCP) Server for each of them.
**
> [Model Context Protocol](https://modelcontextprotocol.io/docs/getting-started/intro)(MCP) is an open protocol that standardizes how applications interact with large language models (LLMs). Launched in late 2024, MCP has become the de facto standard for integrating systems and applications with LLMs, with support now available across major AI platforms, including[OpenAI](https://platform.openai.com/docs/guides/tools-connectors-mcp),[Gemini](https://developers.googleblog.com/en/gemini-cli-fastmcp-simplifying-mcp-server-development/), and[Google&#x27;s Vertex AI](https://cloud.google.com/blog/products/ai-machine-learning/build-and-manage-multi-system-agents-with-vertex-ai).
Platforms like[GitHub](https://github.com/github/github-mcp-server),[AWS](https://github.com/awslabs/mcp)and[ClickHouse](https://github.com/ClickHouse/mcp-clickhouse)build MCP servers, which define sets of tools and resources that LLMs can interact with. The LLM lists the tools available, and picks the most appropriate tool for the action it is trying to take.
For example, the ClickHouse MCP server provides a tool called`run\_select\_query`that can be used to run a SQL SELECT statement against a ClickHouse database. The MCP server implements all of the logic needed to perform that action when the tool is used (creating a connection, authentication, etc.).
MCP servers are conceptually very similar to REST APIs; in fact, before MCP was released, people were just using REST APIs to integrate with LLMs. REST APIs worked pretty well, but MCP provides clearer standardisation for developers and LLMs. MCP servers don‚Äôt replace REST APIs, they often live side-by-side providing functionality for different purposes.
MCP servers originally ran locally as subprocesses, communicating through stdio or SSE (Server-Sent Events). However, there&#x27;s been a recent shift toward platforms hosting remote MCP servers - similar to how REST APIs are deployed.
With remote MCPs, users don&#x27;t run the server themselves; their MCP client simply connects to an already-running service endpoint, often at a URL like`https://api.example.com/mcp`. This shift means MCP servers now need to handle concerns that were previously managed by the client environment: authentication, rate limiting, multi-tenancy, and authorization. Essentially, remote MCP servers are converging with REST APIs in terms of operational requirements, while maintaining MCP&#x27;s standardized protocol for LLM tool usage.
## Agent SDKs[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#agent-sdks)
Agent SDKs are a building block used by developers to build agentic experiences in their applications, often providing much of the boilerplate needed to integrate with MCP servers (and much more). The full feature set offered by agent SDKs varies greatly, with Microsoft Agent Framework making it easy to integrate with[Azure AI Foundry](https://ai.azure.com/), and[Vercel AI SDK](https://ai-sdk.dev/docs/introduction)coming out of the box with chat UI components.
Which agent SDK you choose depends on what matters to the application you‚Äôre building, how much abstraction you prefer, and which languages you intend to use. If you‚Äôre a TypeScript developer building a React app with a chat interface, you‚Äôre likely going to be at home with the Vercel AI SDK, while a Java developer building headless agents will prefer[Google‚Äôs Agent Development Kit Java SDK](https://github.com/google/adk-java).
|Library|Languages supported|Best suited for|
[Claude Agent SDK](https://docs.claude.com/en/api/agent-sdk/overview)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#claude-agent-sdk))|Python
TypeScript|Production deployments with Claude models, security-conscious applications requiring explicit tool allowlists|
[OpenAI Agents SDK](https://openai.github.io/openai-agents-python/)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#openai-agents-sdk))|Python
TypeScript|Agent handoffs and delegation patterns, responsive UIs with streaming tool calls, lightweight composable agents|
[Microsoft Agent Framework](https://azure.microsoft.com/en-us/blog/introducing-microsoft-agent-framework/)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#microsoft-agent-framework))|Python
.NET|Azure ecosystem integration, enterprise features, .NET developers|
[Google Agent Development Kit](https://google.github.io/adk-docs/)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#google-agent-development-kit))|Python
Java|Gemini and Google ecosystem, Java developers, production deployments with web UI/CLI/API|
[CrewAI](https://www.crewai.com/)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#crewai))|Python|Multi-agent workflows, orchestrating fleets of autonomous agents|
[Upsonic](https://upsonic.ai/)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#upsonic))|Python|Financial sector applications, security and scale, handling LLM exploits|
[mcp-agent](https://github.com/lastmile-ai/mcp-agent)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#mcp-agent))|Python|MCP-specific workflows, Anthropic&#x27;s agent patterns (augmented LLM, parallel, router, etc.), lightweight MCP-optimized development|
[Agno](https://github.com/agno-agi/agno)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#agno))|Python|Speed and minimal boilerplate (\~10 lines for MCP), spawning thousands of agents, runtime performance optimization|
[DSPy](https://dspy.ai/)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#dspy))|Python|Automatic prompt optimization, treating prompting as a programming problem, systematically optimizing agent behavior|
[LangChain](https://www.langchain.com/)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#langchain))|Python
JavaScript|Extensive ecosystem of integrations, complex workflows beyond MCP, composability and flexibility|
[LlamaIndex](https://www.llamaindex.ai/)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#llama-index))|Python
TypeScript|Data-aware AI applications, RAG (retrieval-augmented generation), combining structured and unstructured data|
[PydanticAI](https://ai.pydantic.dev/)([‚Üì](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#pydanticai))|Python|Type safety and data validation, runtime type checking, Python applications using Pydantic, testing utilities|
In June 2025, we showed[how to integrate the ClickHouse MCP Server with the most popular AI agent libraries](https://clickhouse.com/blog/integrating-clickhouse-mcp). Only four months later, there‚Äôs a whole raft of new agent SDKs, frameworks and libraries, and remote MCP servers are becoming increasingly common.
![star-history-20251010.png](https://clickhouse.com/uploads/star_history_20251010_1ffeaad5fd.png)*[The GitHub star history for the frameworks discussed in this post](https://www.star-history.com/#pydantic/pydantic-ai&amp;run-llama/llama_index&amp;langchain-ai/langchain&amp;stanfordnlp/dspy&amp;agno-agi/agno&amp;Upsonic/Upsonic&amp;lastmile-ai/mcp-agent&amp;crewAIInc/crewAI&amp;google/adk-python&amp;microsoft/agent-framework&amp;anthropics/claude-agent-sdk-python&amp;openai/openai-agents-python). Source:[https://www.star-history.com](https://www.star-history.com)*
We&#x27;ll cover 12 leading agent SDKs with MCP support:
1. [Claude Agent SDK](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#claude-agent-sdk)
2. [OpenAI Agents SDK](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#openai-agents-sdk)
3. [Microsoft Agent Framework](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#microsoft-agent-framework)
4. [Google Agent Development Kit](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#google-agent-development-kit)
5. [CrewAI](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#crewai)
6. [Upsonic](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#upsonic)
7. [mcp-agent](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#mcp-agent)
8. [Agno](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#agno)
9. [DSPy](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#dspy)
10. [LangChain](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#langchain)
11. [LlamaIndex](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#llama-index)
12. [PydanticAI](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#pydanticai)## Example MCP server[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#example-mcp-server)
These libraries can connect to any MCP server, like[GitHub MCP](https://github.com/github/github-mcp-server),[Google Analytics MCP](https://developers.google.com/analytics/devguides/MCP), or[Azure MCP](https://github.com/microsoft/mcp/tree/main/servers/Azure.Mcp.Server).
To demonstrate these agent libraries in action, we&#x27;ll use the[ClickHouse MCP Server](https://github.com/ClickHouse/mcp-clickhouse). The ClickHouse MCP Server connects ClickHouse to AI assistants, providing tools to execute SQL queries, list databases and tables, and work with both ClickHouse clusters and chDB&#x27;s embedded OLAP engine.
[![Embedded YouTube video](https://img.youtube.com/vi/y9biAm_Fkqw/0.jpg)](https://www.youtube.com/watch?v=y9biAm_Fkqw)
ClickHouse is particularly well-suited for AI agent workloads due to its ability to handle large volumes of data with low latency and high concurrency. Since AI agents tend to send numerous queries and overall user latency is already high, you don&#x27;t want the database making responses even slower.
We&#x27;ll learn how to use these agent libraries with the ClickHouse MCP Server using the[ClickHouse SQL playground](https://clickhouse.com/blog/announcing-the-new-sql-playground). This hosted ClickHouse service contains a variety of datasets, ranging from New York taxi rides to UK property prices.
```
```
`1env = {2&quot;&quot;CLICKHOUSE\_HOST&quot;&quot;:&quot;sql-clickhouse.clickhouse.com&quot;,3&quot;&quot;CLICKHOUSE\_PORT&quot;&quot;:&quot;8443&quot;,4&quot;&quot;CLICKHOUSE\_USER&quot;&quot;:&quot;demo&quot;,5&quot;&quot;CLICKHOUSE\_PASSWORD&quot;&quot;:&quot;&quot;,6&quot;&quot;CLICKHOUSE\_SECURE&quot;&quot;:&quot;true&quot;,7&quot;&quot;CLICKHOUSE\_VERIFY&quot;&quot;:&quot;true&quot;,8&quot;&quot;CLICKHOUSE\_CONNECT\_TIMEOUT&quot;&quot;:&quot;30&quot;,9&quot;&quot;CLICKHOUSE\_SEND\_RECEIVE\_TIMEOUT&quot;&quot;:&quot;30&quot;10}`
```
```
## Claude Agent SDK[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#claude-agent-sdk)
The[Claude Agent SDK](https://github.com/anthropics/claude-agent-sdk-python)by Anthropic is a framework for building autonomous agents. This was initially released as the Claude Code SDK in July 2025 and then[renamed in September 2025](https://www.anthropic.com/engineering/building-agents-with-the-claude-agent-sdk).
Given that Anthropic developed the Model Context Protocol (MCP), it&#x27;s perhaps not surprising that this library offers first-class support for MCP.
[Anthropic‚Äôs Claude models are often regarded as some of the highest performing models for MCP tool usage](https://gorilla.cs.berkeley.edu/leaderboard.html), being good at determining when to request a tool, using the tool correctly, and hallucinating less often.
The Claude Agent SDK is available for both TypeScript and Python. We‚Äôre going to use the Python library, which can be installed using pip:
```
```
`1pip install claude-agent-sdk`
```
```
Integrating our ClickHouse MCP server with the Claude Agent SDK is quite simple. Let‚Äôs have a look at the code:
```
```
`1import asyncio2from claude\_agent\_sdk import query, ClaudeAgentOptions34options = ClaudeAgentOptions(5allowed\_tools=[6&quot;&quot;mcp\_\_mcp-clickhouse\_\_list\_databases&quot;&quot;,7&quot;&quot;mcp\_\_mcp-clickhouse\_\_list\_tables&quot;&quot;,8&quot;&quot;mcp\_\_mcp-clickhouse\_\_run\_select\_query&quot;&quot;,9&quot;&quot;mcp\_\_mcp-clickhouse\_\_run\_chdb\_select\_query&quot;&quot;10],11mcp\_servers={12&quot;mcp-clickhouse&quot;: {13&quot;command&quot;:&quot;uv&quot;,14&quot;args&quot;: [15&quot;run&quot;,16&quot;--with&quot;,&quot;mcp-clickhouse&quot;,17&quot;--python&quot;,&quot;3.10&quot;,18&quot;mcp-clickhouse&quot;19],20&quot;env&quot;: env21}22}23)242526async def main():27query =&quot;&quot;&quot;28Tell me something interesting about UK property sales29&quot;&quot;&quot;30async for message in query(prompt=query, options=options):31print(message)323334asyncio.run(main())`
```
```
The setup is straightforward, but there&#x27;s an interesting difference worth mentioning. Most libraries will discover all available tools from the MCP server by default, while the Claude Agent SDK requires the`allowed\_tools`property to explicitly define which tools it can use. If you find yourself asking ‚ÄúWhy wont the Claude Agent SDK find any MCP tools?‚Äù it might be because you‚Äôve forgotten to set the`allowed\_tools`property.
This is actually a useful security feature - MCP servers can provide a lot of tools, and some tools may give access to features that you do not want to expose in your agent. These could be destructive operations, like dropping a database table or deleting a git repo. The Claude Agent SDK takes a ‚Äúzero trust‚Äù approach, blocking all tools unless explicitly allowed.
üìÑ[View the full Claude Agent SDK example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/claude-agent-sdk)
üß™[Try the Claude Agent SDK notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/claude-agent/claude-agent.ipynb)
## OpenAI Agents SDK[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#openai-agents-sdk)
The[OpenAI Agents SDK](https://github.com/openai/openai-agents-python)is OpenAI&#x27;s official framework for building AI agents, released in December 2024. This SDK represents OpenAI&#x27;s opinionated approach to agent development, incorporating lessons learned from their experimental[Swarm framework](https://github.com/openai/swarm)and focusing on**lightweight, composable agent patterns**rather than heavyweight abstractions.
The OpenAI Agents SDK takes a minimalist approach - it provides just enough structure to build reliable agents without imposing complex architectural decisions. This philosophy extends to its MCP support, which treats MCP servers as native tools that agents can discover and use without additional configuration layers. The SDK is particularly optimized for OpenAI&#x27;s models, with built-in handling for model-specific features like parallel tool calling and structured outputs.
The SDK is available in both Python and TypeScript. For Python, install it via pip:
```
```
`1pip install openai-agents`
```
```
Here&#x27;s how to integrate the ClickHouse MCP server:
```
```
`1fromagents.mcpimportMCPServer, MCPServerStdio2fromagentsimportAgent, Runner, trace3importjson45asyncwithMCPServerStdio(6name=&quot;ClickHouse SQL Playground&quot;,7params={8&quot;command&quot;:&quot;uv&quot;,9&quot;args&quot;: [10&#x27;run&#x27;,11&#x27;--with&#x27;,&#x27;mcp-clickhouse&#x27;,12&#x27;--python&#x27;,&#x27;3.13&#x27;,13&#x27;mcp-clickhouse&#x27;14],15&quot;env&quot;: env16}, client\_session\_timeout\_seconds =6017)asserver:18agent = Agent(19name=&quot;Assistant&quot;,20instructions=&quot;Use the tools to query ClickHouse and answer questions based on those files.&quot;,21mcp\_servers=[server],22)2324message =&quot;What&#x27;s the biggest GitHub project so far in 2025?&quot;25print(f&quot;nnRunning: {message}&quot;)26withtrace(&quot;Biggest project workflow&quot;):27result = Runner.run\_streamed(starting\_agent=agent, input=message, max\_turns=20)28asyncforchunkinresult.stream\_events():29simple\_render\_chunk(chunk)`
```
```
We‚Äôve omitted, the`simple\_render\_chunk`function but brevity, but you can find that code in our[OpenAI agent docs](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/openai-agents). You‚Äôll notice that the function ends up being quite complicated as the library returns us a fine grained response object containing information about tool calls, tool output, as well as a running commentary of what the model is thinking along the way.
What distinguishes the OpenAI Agents SDK is its**focus on agent handoffs and delegation patterns**. Rather than building monolithic agents that try to do everything, the SDK encourages creating specialized agents that can seamlessly hand off tasks to each other. This works particularly well with MCP servers - you might have one agent that specializes in data analysis using the ClickHouse MCP server, another that handles visualization, and they coordinate through the SDK&#x27;s handoff mechanisms.
The SDK also includes first-class support for**streaming responses with tool calls**, making it excellent for building responsive user interfaces where you want to show both the agent&#x27;s thinking process and the MCP tools being called in real-time.
üìÑ[View the full OpenAI Agents SDK example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/openai-agents)
üß™[Try the OpenAI Agents SDK notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/openai-agents/openai-agents.ipynb)
## Microsoft Agent Framework[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#microsoft-agent-framework)
The[Microsoft Agent Framework](https://github.com/microsoft/agent-framework)is currently in public preview as of October 2025. It combines AutoGen, a Microsoft Research project, with Semantic Kernel&#x27;s enterprise features into a single framework for developers.
The Microsoft Agent Framework is available in both .NET and Python. We‚Äôre partial to Python, so we‚Äôll use that. It can be installed using pip, but you need to provide the`--pre`flag as it has not been officially published as of October 2025.
```
```
`1pip install agent-framework --pre`
```
```
Time for some code:
```
```
`1importasyncio2fromagent\_frameworkimportChatAgent, MCPStdioTool3fromagent\_framework.openaiimportOpenAIResponsesClient456asyncdef run\_with\_mcp() -&gt;&gt; None:7clickhouse\_mcp\_server = MCPStdioTool(8name=&quot;clickhouse&quot;,9command=&quot;uv&quot;,10args=[11&quot;run&quot;,12&quot;--with&quot;,&quot;mcp-clickhouse&quot;,13&quot;--python&quot;,&quot;3.10&quot;,14&quot;mcp-clickhouse&quot;15],16env=env17)1819asyncwithChatAgent(20chat\_client=OpenAIResponsesClient(model\_id=&quot;gpt-5-mini-2025-08-07&quot;),21name=&quot;AnalystAgent&quot;,22instructions=&quot;You are a helpful assistant that can help query a ClickHouse database&quot;,23tools=clickhouse\_mcp\_server,24)asagent:25query =&quot;Tell me about UK property prices over the last five years&quot;26print(f&quot;User: {query}&quot;)27asyncforchunkinagent.run\_stream(query):28print(chunk.text, end=&quot;&quot;, flush=True)29print(&quot;nn&quot;)3031asyncio.run(run\_with\_mcp())`
```
```
Although the Microsoft Agent Framework is clearly designed for building AI agents on Azure, you can use OpenAI and Anthropic models directly without using Azure . To use Anthropic models with the Microsoft Agent Framework, you can provide the parameter`base\_url=&quot;&quot;https://api.anthropic.com/v1/&quot;&quot;`when initializing the client.
The Microsoft Agent Framework defaults to having all tools available, but you can provide an allowlist via the[`allowed\_tools`](https://github.com/microsoft/agent-framework/blob/8967269d3eba4bb84544a710e9d675fe216d220c/python/packages/core/agent_framework/_mcp.py#L727)parameter.
üìÑ[View the full Microsoft Agent Framework example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/microsoft-agent-framework)
üß™[Try the Microsoft Agent Framework notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/microsoft-agent-framework/microsoft-agent-framework.ipynb)
## Google Agent Development Kit[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#google-agent-development-kit)
[Google Agent Development Kit](https://google.github.io/adk-docs/)(ADK) is a framework for developing and deploying AI agents. While it includes optimizations for Gemini and the Google ecosystem, it‚Äôs designed to be model-agnostic and deployment-agnostic, with compatibility for other frameworks.
According to their docs, it ‚Äúattempts to make agent development feel more like traditional software development, providing developers with tools to create, deploy, and orchestrate agentic architectures for both simple tasks and complex workflows‚Äù.
The Google Agent Development Kit supports both Python and Java - it‚Äôs one of the only major SDKs we‚Äôve come across that offers support for Java. We‚Äôll continue to use Python, and install the SDK via pip:
```
```
`1pip install google-adk`
```
```
And now for the code:
```
```
`1from google.adk.agents import LlmAgent2from google.adk.tools.mcp\_tool.mcp\_toolset import MCPToolset3from google.adk.tools.mcp\_tool.mcp\_session\_manager import StdioConnectionParams4from mcp import StdioServerParameters567root\_agent = LlmAgent(8model=&#x27;gemini-2.5-flash&#x27;,9name=&#x27;&#x27;database\_agent&#x27;&#x27;,10instruction=&#x27;Help the user query a ClickHouse database.&#x27;,11tools=[12MCPToolset(13connection\_params=StdioConnectionParams(14server\_params = StdioServerParameters(15command=&#x27;uv&#x27;,16args=[17&quot;run&quot;,18&quot;--with&quot;,&quot;mcp-clickhouse&quot;,19&quot;--python&quot;,&quot;3.10&quot;,20&quot;mcp-clickhouse&quot;21],22env=env23),24timeout=60,25),26)27],28)`
```
```
This one is a bit different, as you only define the agent - there isn‚Äôt an easy way (at least that we could find) to call the agent in code. Instead, there are various commands that you can execute from the terminal to run the agent. For example, we can launch a web UI by running the following:
```
```
`1uv run --with google-adk adk web`
```
```
If you take this approach, you get a ChatGPT-esque UI where you can ask questions and have them answered by the model. It will show you the tools that it calls along the way.
Alternatively, there‚Äôs an experimental CLI that you can launch like this:
```
```
`1uv run --with google-adk adk run mcp\_agent`
```
```
This time, you will get a prompt like this:
```
`[user]: Tell me about UK property pricesinthe early2020s`
```
You ask your question, press enter, and off it goes:
```
`2025-10-0916:40:15,882-mcp-clickhouse-INFO-Listingalldatabases2025-10-0916:40:15,882-mcp-clickhouse-INFO-Creating ClickHouse client connectiontosql-clickhouse.clickhouse.com:8443asdemo (secure=True, verify=True, connect\_timeout=30s, send\_receive\_timeout=30s)2025-10-0916:40:16,578-mcp-clickhouse-INFO-Successfully connectedtoClickHouse server version25.8.1.83442025-10-0916:40:16,756-mcp-clickhouse-INFO-Found38databases2025-10-0916:40:16,765-mcp.server.lowlevel.server-INFO-Processing requestoftype ListToolsRequest2025-10-0916:40:18,612-mcp.server.lowlevel.server-INFO-Processing requestoftype CallToolRequest2025-10-0916:40:18,620-mcp-clickhouse-INFO-Listing tablesindatabase&#x27;uk&#x27;2025-10-0916:40:18,621-mcp-clickhouse-INFO-Creating ClickHouse client connectiontosql-clickhouse.clickhouse.com:8443asdemo (secure=True, verify=True, connect\_timeout=30s, send\_receive\_timeout=30s)2025-10-0916:40:19,298-mcp-clickhouse-INFO-Successfully connectedtoClickHouse server version25.8.1.83442025-10-0916:40:20,764-mcp-clickhouse-INFO-Found9tables2025-10-0916:40:20,772-mcp.server.lowlevel.server-INFO-Processing requestoftype ListToolsRequest2025-10-0916:40:26,109-mcp.server.lowlevel.server-INFO-Processing requestoftype CallToolRequest2025-10-0916:40:26,112-mcp-clickhouse-INFO-ExecutingSELECTquery:SELECTtoYear(date)ASyear,avg(price)ASaverage\_priceFROMuk.uk\_price\_paid\_with\_projections\_v2WHEREdate&gt;=&#x27;2020-01-01&#x27;ANDdate&lt;=&#x27;2022-12-31&#x27;GROUPBYyearORDERBYyear2025-10-0916:40:26,113-mcp-clickhouse-INFO-Creating ClickHouse client connectiontosql-clickhouse.clickhouse.com:8443asdemo (secure=True, verify=True, connect\_timeout=30s, send\_receive\_timeout=30s)2025-10-0916:40:26,703-mcp-clickhouse-INFO-Successfully connectedtoClickHouse server version25.8.1.83442025-10-0916:40:27,436-mcp-clickhouse-INFO-Query returned3rows2025-10-0916:40:27,443-mcp.server.lowlevel.server-INFO-Processing requestoftype ListToolsRequest
[database\_agent]: The average UK property pricesinthe early2020s were:\*\*\*2020:\*\*¬£377,777.77\*\*\*2021:\*\*¬£388,990.83\*\*\*2022:\*\*¬£413,481.61`
```
Or, you can run the agent via an API endpoint, which we expect is the preferred mode of usage:
```
```
`1uv run--with google-adk adk api\_server`
```
```
üìÑ[View the full Google Agent Development Kit example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/google-agent-development-kit)
üß™[Try the Google Agent Development Kit example](https://github.com/ClickHouse/examples/blob/main/ai/mcp/google-agent-development-kit)
## CrewAI[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#crewai)
[CrewAI](https://github.com/crewAIInc/crewAI)is an agent framework with a particular**emphasis on building multi-agent workflows**. While the framework itself is open source, the company behind it offers a commercial platform designed for orchestrating and managing fleets of autonomous agents.
CrewAI is available only in Python and installed with pip:
```
```
`1pip install&quot;crewai-tools[mcp]&quot;`
```
```
The code to build a CrewAI agent with ClickHouse MCP support is shown below:
```
```
`1from crewai import Agent2from crewai\_tools import MCPServerAdapter3from mcp import StdioServerParameters45server\_params=StdioServerParameters(6command=&#x27;uv&#x27;,7args=[8&quot;run&quot;,9&quot;--with&quot;,&quot;mcp-clickhouse&quot;,10&quot;--python&quot;,&quot;3.10&quot;,11&quot;mcp-clickhouse&quot;12],13env=env14)1516with MCPServerAdapter(server\_params, connect\_timeout=60) as mcp\_tools:17print(f&quot;&quot;Available tools: {[tool.name for tool in mcp\_tools]}&quot;&quot;)1819my\_agent = Agent(20role=&quot;MCP Tool User&quot;,21goal=&quot;Utilize tools from an MCP server.&quot;,22backstory=&quot;I can connect to MCP servers and use their tools.&quot;,23tools=mcp\_tools,24reasoning=True,25verbose=True26)27my\_agent.kickoff(messages=[28{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;Tell me about property prices in London between 2024 and 2025&quot;}29])`
```
```
üìÑ[View the full CrewAI example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/crewai)
üß™[Try the CrewAI notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/crewai/crewai.ipynb)
## mcp-agent[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#mcp-agent)
[mcp-agent](https://github.com/lastmile-ai/mcp-agent)is a framework by[lastmileAI](https://lastmileai.dev/)that takes deep inspiration from[Anthropic‚Äôs Building effective agents](https://www.anthropic.com/engineering/building-effective-agents)paper. The paper covers various patterns and workflows that Anthropic has seen perform well in real-world agentic applications, and mcp-agent offers a composable framework for developing agents that follow Anthropic‚Äôs guidance.
mcp-agent‚Äôs integration with MCP feels largely similar to the other frameworks and SDKs in this post, and the framework is not offering the extensive bells-and-whistles that you might get from the likes of Google‚Äôs ADK. Instead, mcp-agent is (as you might guess from the name)**designed specifically for MCP**, offering developers a simple, lightweight library that is highly optimized for the patterns suggested by Anthropic:
* [Augmented LLM](https://github.com/lastmile-ai/mcp-agent?tab=readme-ov-file#augmentedllm)
* [Parallel](https://github.com/lastmile-ai/mcp-agent?tab=readme-ov-file#parallel)
* [Router](https://github.com/lastmile-ai/mcp-agent?tab=readme-ov-file#router)
* [Intent-Classifier](https://github.com/lastmile-ai/mcp-agent?tab=readme-ov-file#intentclassifier)
* [Orchestrator-Workers](https://github.com/lastmile-ai/mcp-agent?tab=readme-ov-file#orchestrator-workers)
* [Evaluator-Optimizer](https://github.com/lastmile-ai/mcp-agent?tab=readme-ov-file#evaluator-optimizer)
mcp-agent also provides support for the experimental[OpenAI Swarm](https://github.com/lastmile-ai/mcp-agent?tab=readme-ov-file#swarm-1), which has now been replaced by the new[OpenAI Agents SDK](https://github.com/openai/openai-agents-python).
mcp-agent is a Python library that can be installed via pip:
```
```
`1pip install mcp-agent openai`
```
```
And the code is shown below:
```
```
`1frommcp\_agent.appimportMCPApp2frommcp\_agent.agents.agentimportAgent3frommcp\_agent.workflows.llm.augmented\_llm\_openaiimportOpenAIAugmentedLLM4frommcp\_agent.configimportSettings, MCPSettings, MCPServerSettings, OpenAISettings56settings = Settings(7execution\_engine=&quot;asyncio&quot;,8openai=OpenAISettings(9default\_model=&quot;gpt-5-mini-2025-08-07&quot;,10),11mcp=MCPSettings(12servers={13&quot;clickhouse&quot;: MCPServerSettings(14command=&#x27;uv&#x27;,15args=[16&quot;run&quot;,17&quot;--with&quot;,&quot;mcp-clickhouse&quot;,18&quot;--python&quot;,&quot;3.10&quot;,19&quot;mcp-clickhouse&quot;20],21env=env22),23}24),25)2627app = MCPApp(name=&quot;&quot;mcp\_basic\_agent&quot;&quot;, settings=settings)2829asyncwithapp.run()asmcp\_agent\_app:30logger = mcp\_agent\_app.logger31data\_agent = Agent(32name=&quot;database-anayst&quot;,33instruction=&quot;&quot;&quot;You can answer questions with help from a ClickHouse database.&quot;&quot;&quot;,34server\_names=[&quot;clickhouse&quot;],35)3637asyncwithdata\_agent:38llm =awaitdata\_agent.attach\_llm(OpenAIAugmentedLLM)39result =awaitllm.generate\_str(40message=&quot;Tell me about UK property prices in 2025. Use ClickHouse to work it out.&quot;41)4243logger.info(result)`
```
```
üìÑ[View the full mcp-agent example](javascript:void(0))
üß™[Try the mcp-agent notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/mcp-agent/mcp-agent.ipynb)
## Upsonic[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#upsonic)
[Upsonic](https://github.com/Upsonic/Upsonic)is an AI agent framework targeted toward the financial sector. Being used in finance, it emphasises its ability to handle scale, and deflect common attacks that attempt to exploit LLMs.
Upsonic is available in Python, and installed using pip:
```
```
`1pip install&quot;upsonic[loaders,tools]&quot;openai`
```
```
The code to create an agent enabled with MCP is familiar:
```
```
`1from upsonic import Agent, Task2from upsonic.models.openai import OpenAIResponsesModel34class DatabaseMCP:5&quot;&quot;&quot;6MCP server for ClickHouse database operations.7Provides tools for querying tables and databases8&quot;&quot;&quot;9command=&quot;uv&quot;10args=[11&quot;run&quot;,12&quot;--with&quot;,&quot;mcp-clickhouse&quot;,13&quot;--python&quot;,&quot;3.10&quot;,14&quot;mcp-clickhouse&quot;15]16env=env171819database\_agent = Agent(20name=&quot;Data Analyst&quot;,21role=&quot;ClickHouse specialist.&quot;,22goal=&quot;Query ClickHouse database and tables and answer questions&quot;,23model=OpenAIResponsesModel(model\_name=&quot;gpt-5-mini-2025-08-07&quot;)24)252627task = Task(28description=&quot;Tell me what happened in the UK property market in the 2020s. Use ClickHouse.&quot;,29tools=[DatabaseMCP]30)3132workflow\_result = database\_agent.do(task)33print(&quot;nMulti-MCP Workflow Result:&quot;)34print(workflow\_result)`
```
```
This time the MCP Server needs to be wrapped inside a class that you provide as a tool rather than passing in the tool logic directly to the task. It‚Äôs not a big difference compared to other libraries, but seems worth pointing out.
Interestingly, given that Upsonic has a ‚Äúsecurity first‚Äù approach, it appears to discover and enable all MCP tools by default, as opposed to the ‚Äúzero trust‚Äù approach of the Claude Agent SDK which requires an explicit allowlist of tools.
üìÑ[View the full Upsonic example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/upsonic)
üß™[Try the Upsonic notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/upsonic/upsonic.ipynb)
## Agno[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#agno)
[Agno](https://github.com/agno-agi/agno)is a framework that prioritizes**speed - both development velocity and runtime performance**. The framework aims for minimal boilerplate, with MCP integration achievable in about 10 lines of code, which is the shortest of all the libraries that we explored. This focus on simplicity extends throughout the framework, with Pythonic APIs that avoid unnecessary abstractions.
Performance is a key differentiator for Agno. They&#x27;&#x27;ve optimized for scenarios where workflows spawn thousands of agents, recognizing that even modest user bases can hit performance bottlenecks with agent systems. Their benchmarks show agent instantiation at \~3Œºs on average with a memory footprint of \~6.5KB per agent - numbers that matter when you&#x27;&#x27;re running agent fleets at scale.
Agno is Python-only and can be installed via pip:
```
```
`1pip install agno`
```
```
And the code to build a ClickHouse-backed agent is as follows:
```
```
`1fromagno.agentimportAgent2fromagno.tools.mcpimportMCPTools3fromagno.models.anthropicimportClaude45asyncwithMCPTools(command=&quot;uv run --with mcp-clickhouse --python 3.13 mcp-clickhouse&quot;, env=env, timeout\_seconds=60)asmcp\_tools:6agent = Agent(7model=Claude(id=&quot;claude-3-5-sonnet-20240620&quot;),8markdown=True,9tools = [mcp\_tools]10)11awaitagent.aprint\_response(&quot;What&#x27;s the most starred project in 2025?&quot;, stream=True)`
```
```
Beyond the open-source framework, Agno is building AgentOS, a development platform designed to bridge the gap from development to production. AgentOS adds deployment capabilities, observability, and monitoring to agents built with the Agno framework. The platform handles the operational complexity of running agents in production while maintaining the simplicity that defines the core framework.
üìÑ[View the full Agno example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/agno)
üß™[Try the Agno notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/agno/agno.ipynb)
## DSPy[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#dspy)
[DSPy](https://github.com/stanfordnlp/dspy)takes a fundamentally different approach to building AI agents. Rather than writing explicit prompts and chaining tools together, DSPy treats**prompting as a programming problem**that can be optimized automatically. It&#x27;s essentially a compiler for AI pipelines - you define what you want to accomplish, and DSPy figures out the best prompts and configurations to achieve it.
DSPy&#x27;s MCP integration is particularly interesting because it can automatically learn how to use MCP tools effectively. Instead of manually crafting prompts that explain how to use your ClickHouse MCP server, DSPy can generate and optimize these prompts based on examples of successful interactions. This makes it excellent for scenarios where you need to integrate multiple MCP servers and want the system to learn the most effective ways to coordinate between them.
DSPy is Python-only and installed via pip:
```
```
`1pip install dspy`
```
```
And, let‚Äôs have a look at the code:
```
```
`1frommcpimportClientSession, StdioServerParameters2frommcp.client.stdioimportstdio\_client3importdspy45server\_params = StdioServerParameters(6command=&quot;uv&quot;,7args=[8&#x27;run&#x27;,9&#x27;--with&#x27;,&#x27;mcp-clickhouse&#x27;,10&#x27;--python&#x27;,&#x27;3.13&#x27;,11&#x27;mcp-clickhouse&#x27;12],13env=env14)1516classDataAnalyst(dspy.Signature):17&quot;&quot;&quot;Youareadataanalyst.You&#x27;llbeaskedquestionsandyouneedtotrytoanswerthemusingthetoolsyouhaveaccessto. &quot;&quot;&quot;1819user\_request:str= dspy.InputField()20process\_result: str = dspy.OutputField(21desc=(22&quot;Answer to the query&quot;23)24)2526fromutilsimportprint\_dspy\_result2728asyncwithstdio\_client(server\_params)as(read, write):29asyncwithClientSession(read, write)assession:30awaitsession.initialize()31tools =awaitsession.list\_tools()3233dspy\_tools = []34fortoolintools.tools:35dspy\_tools.append(dspy.Tool.from\_mcp\_tool(session, tool))3637react = dspy.ReAct(DataAnalyst, tools=dspy\_tools)38result =awaitreact.acall(user\_request=&quot;What&#x27;s the most popular Amazon product category&quot;)39print\_dspy\_result(result)`
```
```
A unique feature of DsPy is that you need to provide a signature class to your requests. Our signature is reasonably simple - it takes in a string and returns a string. We‚Äôve excluded the[`print\_dspy\_result`](https://github.com/ClickHouse/examples/blob/main/ai/mcp/dspy/utils.py)function for brevity, but if you take a look at[the code on GitHub](https://github.com/ClickHouse/examples/blob/main/ai/mcp/dspy/utils.py), you can see that DsPy gives us back a very fine grained response.
The key advantage of DSPy is its ability to**systematically optimize agent behavior**. If you find yourself constantly tweaking prompts to get better results from your MCP tools, DSPy can automate this process. It&#x27;s particularly powerful when combined with evaluation datasets - you can define what &quot;good&quot; looks like for your agent&#x27;s outputs, and DSPy will optimize the entire pipeline to maximize that metric.
üìÑ[View the full DSPy example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/dspy)
üß™[Try the DSPy notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/dspy/dspy.ipynb)
## LangChain[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#langchain)
[LangChain](https://github.com/langchain-ai/langchain)is one of the most established frameworks in the AI agent ecosystem, predating MCP by several years. It&#x27;s known for its**extensive ecosystem of integrations**- if there&#x27;s a tool, database, or LLM you want to use, LangChain probably has an integration for it. With MCP support added in early 2025, LangChain now bridges its massive ecosystem with the standardized MCP protocol.
What makes LangChain&#x27;s MCP implementation unique is how it treats MCP servers as just another type of tool in its vast toolkit. This means you can seamlessly combine MCP servers with LangChain&#x27;s hundreds of other integrations - use an MCP server to query ClickHouse, then feed those results into a LangChain document loader, vector store, or any other component.
LangChain supports both Python and JavaScript/TypeScript:
```
```
`1pip install langchain langchain-mcp`
```
```
The code is shown below:
```
```
`1from mcp import ClientSession, StdioServerParameters2from mcp.client.stdio import stdio\_client34server\_params = StdioServerParameters(5command=&quot;uv&quot;,6args=[7&quot;run&quot;,8&quot;--with&quot;,&quot;mcp-clickhouse&quot;,9&quot;--python&quot;,&quot;3.13&quot;,10&quot;mcp-clickhouse&quot;11],12env=env13)1415async with stdio\_client(server\_params) as (read, write):16async with ClientSession(read, write) as session:17await session.initialize()18tools = await load\_mcp\_tools(session)19agent = create\_react\_agent(&quot;anthropic:claude-sonnet-4-0&quot;, tools)2021handler = UltraCleanStreamHandler()22async for chunk in agent.astream\_events(23{&quot;messages&quot;: [{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;Who&#x27;s committed the most code to ClickHouse?&quot;}]},24version=&quot;v1&quot;25):26handler.handle\_chunk(chunk)2728print(&quot;n&quot;)`
```
```
We‚Äôve excluded the`UltraCleanStreamHandler`for brevity. We need this custom stream handler as LangChain also returns fine grained output describing tool calls, tool outputs, as well as a commentary on what the agent is thinking.
LangChain&#x27;s strength lies in its**composability and flexibility**. While newer frameworks might offer cleaner APIs for MCP specifically, LangChain excels when you need to build complex workflows that go beyond just MCP tools. Its extensive documentation and large community also mean you&#x27;ll find examples and solutions for almost any integration challenge.
üìÑ[View the full LangChain example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/langchain)
üß™[Try the LangChain notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/langchain/langchain.ipynb)
## LlamaIndex[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#llama-index)
[LlamaIndex](https://github.com/run-llama/llama_index/)(formerly GPT Index) specializes in**data-aware AI applications**, particularly those involving retrieval-augmented generation (RAG). While other frameworks focus on general agent capabilities, LlamaIndex is optimized for scenarios where agents need to work with large amounts of structured and unstructured data.
LlamaIndex&#x27;s MCP integration is designed to work seamlessly with its data indexing and retrieval capabilities. This makes it particularly powerful when combined with analytical databases like ClickHouse - you can use MCP tools to query structured data, then combine those results with LlamaIndex&#x27;s document retrieval and synthesis capabilities to provide comprehensive answers.
Available in both Python and TypeScript:
```
```
`1pip install llama-index llama-index-mcp`
```
```
And the code:
```
```
`1from llama\_index.tools.mcp import BasicMCPClient, McpToolSpec23mcp\_client = BasicMCPClient(4&quot;uv&quot;,5args=[6&quot;run&quot;,7&quot;--with&quot;,&quot;mcp-clickhouse&quot;,8&quot;--python&quot;,&quot;3.13&quot;,9&quot;mcp-clickhouse&quot;10],11env=env12)1314mcp\_tool\_spec = McpToolSpec(15client=mcp\_client,16)1718tools = await mcp\_tool\_spec.to\_tool\_list\_async()1920from llama\_index.core.agent import AgentRunner, FunctionCallingAgentWorker2122agent\_worker = FunctionCallingAgentWorker.from\_tools(23tools=tools,24llm=llm, verbose=True, max\_function\_calls=1025)26agent = AgentRunner(agent\_worker)2728from llama\_index.llms.anthropic import Anthropic29llm = Anthropic(model=&quot;claude-sonnet-4-0&quot;)3031response = agent.query(&quot;What&#x27;s the most popular repository?&quot;)`
```
```
The framework&#x27;s**query engine abstraction**is what sets it apart. Rather than thinking about individual tool calls, LlamaIndex lets you define complex query patterns that can automatically orchestrate multiple MCP servers, retrieve relevant documents, and synthesize responses. This is particularly useful for building agents that need to answer complex analytical questions by combining data from multiple sources.
üìÑ[View the full LlamaIndex example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/llamaindex)
üß™[Try the LlamaIndex notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/llamaindex/llamaindex.ipynb)
## PydanticAI[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#pydanticai)
[PydanticAI](https://github.com/pydantic/pydantic-ai)launched in December 2024 by the team behind the popular Pydantic validation library. It brings Pydantic&#x27;s philosophy of**type safety and data validation**to the world of AI agents. If you&#x27;ve ever struggled with agents returning inconsistently formatted data or making type errors when calling tools, PydanticAI aims to solve these problems.
PydanticAI&#x27;s MCP integration leverages Pydantic&#x27;s powerful validation system to ensure that all inputs and outputs from MCP servers conform to expected schemas. This means runtime type checking for all MCP tool calls, automatic validation of responses, and clear error messages when something goes wrong. It&#x27;s particularly valuable when building agents that need to integrate with existing Python applications that already use Pydantic for data validation.
Python-only, installed via pip:
```
```
`1pip install pydantic-ai`
```
```
Let‚Äôs have a look at the code:
```
```
`1frompydantic\_aiimportAgent2frompydantic\_ai.mcpimportMCPServerStdio34server = MCPServerStdio(5&#x27;uv&#x27;,6args=[7&#x27;run&#x27;,8&#x27;--with&#x27;,&#x27;mcp-clickhouse&#x27;,9&#x27;--python&#x27;,&#x27;3.13&#x27;,10&#x27;mcp-clickhouse&#x27;11],12env=env13)14agent = Agent(&#x27;anthropic:claude-sonnet-4-0&#x27;, mcp\_servers=[server])1516asyncwithagent.run\_mcp\_servers():17result =awaitagent.run(&quot;Who&#x27;s done the most PRs for ClickHouse?&quot;)18print(result.output)`
```
```
What makes PydanticAI compelling is its**focus on correctness and developer experience**. By treating agent responses as structured data that can be validated and typed, it brings many of the benefits of static typing to the inherently dynamic world of LLMs. The framework also includes excellent testing utilities, making it easier to write unit tests for agents that use MCP servers - something that&#x27;s traditionally been challenging.
üìÑ[View the full PydanticAI example](https://clickhouse.com/docs/use-cases/AI/MCP/ai-agent-libraries/pydanticai)
üß™[Try the PydanticAI notebook](https://github.com/ClickHouse/examples/blob/main/ai/mcp/pydanticai/pydantic.ipynb)
## Frequently Asked Questions[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#faq)
### What is the best AI agent framework for MCP?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#what-is-the-best-ai-agent-framework-for-mcp)
There&#x27;s no single &quot;best&quot; framework - it depends on your use case. For production deployments with Claude models, the Claude Agent SDK offers the tightest integration. If you&#x27;re already in the Azure ecosystem, Microsoft Agent Framework is the obvious choice.
For complex multi-agent workflows, CrewAI excels. LangChain wins on ecosystem breadth, while PydanticAI is best if you need type safety and validation. Anf if you want to write the smallest amount of code, don‚Äôt forget to look at Agno.
### Can I use multiple MCP servers with one agent?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#can-i-use-multiple-mcp-servers-with-one-agent)
Yes, most frameworks support connecting to multiple MCP servers simultaneously. Your agent can use tools from a ClickHouse MCP server for data analysis, a GitHub MCP server for code operations, and a Slack MCP server for notifications - all in the same workflow. The agent will automatically select the appropriate server based on the tools it needs.
### Is MCP better than OpenAI function calling?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#is-mcp-better-than-openai-function-calling)
They&#x27;re complementary, not competing. OpenAI function calling is model-specific, while MCP is model-agnostic. MCP provides standardization across different LLM providers and includes features like resource management and progress reporting that go beyond simple function calling. Many frameworks use function calling under the hood to implement MCP.
### How much latency does MCP add?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#how-much-latency-does-mcp-add)
MCP itself adds minimal overhead - typically 10-50ms for the protocol layer. The real latency comes from tool execution. For a ClickHouse query, you&#x27;re looking at the database query time plus MCP overhead. In practice, expect 50-200ms additional latency compared to direct API calls, though this is usually negligible compared to LLM inference time (2-5 seconds).
### Do MCP servers work with local LLMs?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#do-mcp-servers-work-with-local-llms)
Yes, MCP is model-agnostic. You can use MCP servers with local models through frameworks like LangChain or LlamaIndex. The quality of tool usage will depend on the model&#x27;s capabilities - models like Llama 3.3 70B or Qwen 2.5 72B handle MCP tools well, while smaller models may struggle with complex tool selection.
### Can I use MCP servers without an agent framework?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#can-i-use-mcp-servers-without-an-agent-framework)
Technically yes, but it&#x27;s not recommended. You&#x27;d need to implement the MCP client protocol yourself, handle tool discovery, manage message passing, and deal with error handling. The frameworks in this guide handle all of this complexity for you. Even lightweight options like the OpenAI Agents SDK are easier than rolling your own.
### How do I debug MCP connection issues?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#how-do-i-debug-mcp-connection-issues)
Start by checking the MCP server logs - most servers provide detailed logging. Common issues include authentication failures (check your environment variables), network connectivity (ensure the host is reachable), and timeout errors (increase connection timeout). Use the`--verbose`flag when running MCP servers locally to see detailed debug output.
### What&#x27;s the difference between local and remote MCP servers?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#whats-the-difference-between-local-and-remote-mcp-servers)
Local MCP servers run as subprocess on your machine using stdio communication - they&#x27;re started and stopped by your agent. Remote MCP servers run as standalone services accessed over HTTP/WebSocket, supporting multiple concurrent clients. Local servers are simpler to set up but don&#x27;t scale. Remote servers require more infrastructure but support production workloads.
### Can MCP servers modify data or only read it?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#can-mcp-servers-modify-data-or-only-read-it)
MCP servers can provide any tools they want, including destructive operations. The ClickHouse MCP server intentionally only provides`run\_select\_query`to prevent accidental data modification, but other servers might offer write operations. Always review which tools an MCP server exposes, especially in production. The Claude Agent SDK&#x27;s allowlist approach is good practice here.
### How do I handle MCP server authentication?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#how-do-i-handle-mcp-server-authentication)
Authentication is handled through environment variables passed to the MCP server on startup. Each server defines its own auth requirements - ClickHouse uses standard database credentials, GitHub uses personal access tokens, etc. Store credentials securely (use environment variables, not hardcoded values) and ensure they have minimal required permissions.
### What happens if an MCP tool call fails?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#what-happens-if-an-mcp-tool-call-fails)
Error handling varies by framework. Most will return the error to the LLM, which can then decide whether to retry, try a different approach, or report the failure. Some frameworks like Agno include automatic retry logic. You should implement timeout handling and consider circuit breakers for production deployments.
### Can I create custom MCP servers?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#can-i-create-custom-mcp-servers)
Yes, MCP is an open protocol.[You can build MCP servers in Python](https://modelcontextprotocol.io/docs/develop/build-server), TypeScript, or any language that can handle JSON-RPC over stdio or HTTP. The[MCP SDK](https://github.com/modelcontextprotocol/python-sdk)provides templates and utilities. Custom servers are useful for exposing internal APIs or building domain-specific tools.
### How do MCP servers handle concurrent requests?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#how-do-mcp-servers-handle-concurrent-requests)
This depends on the server implementation. Stdio-based local servers typically handle one request at a time. Remote MCP servers can handle concurrent requests, but may have rate limits. The ClickHouse MCP server creates separate database connections per request, allowing concurrent queries up to the database&#x27;s connection limit.
### Which LLMs work best with MCP tools?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#which-llms-work-best-with-mcp-tools)
Claude 3.5 Sonnet and Opus consistently top the tool usage benchmarks. GPT-4 and GPT-4 Turbo perform well but may hallucinate tool parameters more often. In our experience, the GPT-5 series of models interact with MCP servers more effectively.
Gemini 2.0 Flash is fast and capable, but we‚Äôve found that the 2.5 series of models work better with MCP. Open-source models like Llama 3.3 70B and Qwen 2.5 72B can handle MCP tools but require more explicit instructions.
### Do I need to pay for MCP?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#do-i-need-to-pay-for-mcp)
MCP itself is free and open source. You pay for the LLM API calls and any resources the MCP servers connect to (databases, APIs, etc.). The agent frameworks are mostly open source, though some offer paid cloud platforms for deployment and monitoring.
### How do I deploy MCP agents to production?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#how-do-i-deploy-mcp-agents-to-production)
For simple deployments, containerize your agent and MCP servers together. For scale, run remote MCP servers as separate services behind a load balancer, and deploy agents as stateless workers. Consider using platforms like Modal, Railway, or the commercial offerings from CrewAI or LangChain for managed deployments. Monitor tool usage, implement rate limiting, and ensure proper error handling.
### Can MCP servers access local files?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#can-mcp-servers-access-local-files)
MCP servers can technically access anything the process can reach, but this is controlled by the server implementation. The filesystem MCP server explicitly provides file access tools. Always run MCP servers with minimal permissions and consider sandboxing them in production environments.
### What&#x27;s the difference between MCP and LangChain tools?[#](https://clickhouse.com/blog/how-to-build-ai-agents-mcp-12-frameworks#whats-the-difference-between-mcp-and-langchain-tools)
LangChain tools are framework-specific, while MCP is a universal protocol. LangChain now supports MCP servers as a type of tool, giving you access to both ecosystems. MCP provides better standardization and portability, while LangChain tools may offer deeper framework integration.
### Get started today
Interested in seeing how ClickHouse works on your data? Get started with ClickHouse Cloud in minutes and receive $300 in free credits.
[Sign up](https://clickhouse.cloud/signUp?loc=blog-global-cta&amp;utm_source=clickhouse&amp;utm_medium=web&amp;utm_campaign=blog)
Share this post
Copy URLShare on Y CombinatorShare on TwitterShare on BlueSkyShare on FacebookShare on LinkedIn
### Subscribe to our newsletter
Stay informed on feature releases, product roadmap, support, and cloud offerings!
Loading form...
## Recent posts
[View all Blogs](https://clickhouse.com/blog)
[
![New functions you might have missed in 2025](https://clickhouse.com/uploads/medium_Click_House_New_Functions_2025_79a1dfff0c.jpg)
Engineering
New functions you might have missed in 2025
Mark Needham ¬∑Dec 23, 2025
](https://clickhouse.com/blog/new-functions-2025)
[
![ClickHouse Cloud now available on Azure UAE North: Bringing real-time analytics to the heart of the Middle East](https://clickhouse.com/uploads/medium_Click_House_Cloud_Azure_UAE_North_7619c5a315.jpg)
Product
ClickHouse Cloud now available on Azure UAE North: Bringing real-time analytics to the heart of the Middle East
Anne Loyens ¬∑Dec 22, 2025
](https://clickhouse.com/blog/clickhouse-cloud-azure-uae-north)
[
![What really matters for performance: lessons from a year of benchmarks](https://clickhouse.com/uploads/medium_527657444_6c939522_a72b_4802_92e1_e5f3c8da60eb_7418edc00e.jpg)
Engineering
What really matters for performance: lessons from a year of benchmarks
Tom Schreiber ¬∑Dec 22, 2025
](https://clickhouse.com/blog/what-really-matters-for-performance-lessons-from-a-year-of-benchmarks)
[
![Alexey&#x27;s favorite features of 2025](https://clickhouse.com/uploads/medium_Release_Blog_Cover_33_9f4ac85f9d.png)
Engineering
Alexey&#x27;s favorite features of 2025
Alexey Milovidov ¬∑Dec 19, 2025
](https://clickhouse.com/blog/alexey-favorite-features-2025)
Follow us
[![X](https://clickhouse.com/socials/x.svg)X](https://x.com/ClickhouseDB)[![Bluesky](https://clickhouse.com/socials/bluesky.svg)Bluesky](https://bsky.app/profile/clickhouse.com)[![Slack](https://clickhouse.com/socials/slack.svg)Slack](https://clickhouse.com/slack)
[![GitHub](https://clickhouse.com/socials/github.svg)GitHub](https://github.com/ClickHouse/ClickHouse)[![Telegram](https://clickhouse.com/socials/telegram.svg)Telegram](https://telegram.me/clickhouse_en)[![Meetup](https://clickhouse.com/socials/meetup.svg)Meetup](https://www.meetup.com/pro/clickhouse)
[![Rss](https://clickhouse.com/socials/rss.svg)Rss](https://clickhouse.com/rss.xml)
